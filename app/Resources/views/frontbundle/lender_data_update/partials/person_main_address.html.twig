<div class="field-help">
    <p>{% trans %} lender-profile_information-tab-fiscal-address-help-message {% endtrans %}</p>
</div>
<section id="data-update-main-address-view" role="tabpanel" class="lender-data-update-view collapse in">
    <dl class="list-2col">
        <dt>{% trans %} lender-profile_information-tab-fiscal-address-section-address-label {% endtrans %}</dt>
        <dd id="data-update-main-address-street-output">{{ mainAddress.getAddress()|default('') }}</dd>
        <dt>{% trans %} lender-profile_information-tab-fiscal-address-section-zip-label {% endtrans %}</dt>
        <dd id="data-update-main-address-zip-output">{{ mainAddress.getZip()|default('') }}</dd>
        <dt>{% trans %} lender-profile_information-tab-fiscal-address-section-city-label {% endtrans %}</dt>
        <dd id="data-update-main-address-city-output">{{ mainAddress.getCity()|default('') }}</dd>
        <dt>{% trans %} lender-profile_information-tab-fiscal-address-section-country-label {% endtrans %}</dt>
        <dd id="data-update-main-address-country-output">{{ mainAddress.getIdCountry().getFr()|default('') }}</dd>
        <dt>{% trans %} lender-profile_information-tab-fiscal-address-section-attachments {% endtrans %}</dt>
        <dd id="profile-address-fichier-domicile-output">
            {% set isHousedByThirdPerson = false %}
            {% for attachment in residenceAttachments %}
                {% if attachment is not null %}
                    {% set attachmentDate = attachment.updated|default(attachment.added)|localizeddate('short', 'none', app.request.locale) %}
                    {% if attachment.type.id == constant('\\Unilend\\Bundle\\CoreBusinessBundle\\Entity\\AttachmentType::CNI_PASSPORT_TIERS_HEBERGEANT') %}
                        {% set isHousedByThirdPerson = true %}
                        <span id="form-profile-info-file-identite-cni-1-output" class="file-justificatif file-identity-side-a"
                              title="{{ "lender-profile_lender-attachment-provided-label-type-#{ attachment.type.id }"|trans({'%date%' : attachmentDate}) }}"
                              data-toggle="tooltip">
                            <span class="sr-only">{{ "lender-profile_lender-attachment-provided-label-type-#{ attachment.type.id }"|trans({'%date%' : attachmentDate})}}</span>
                        </span>
                    {% else %}
                        <span id="form-profile-address-file-domicile-1-output" class="file-justificatif file-domicile" title="{{ "lender-profile_lender-attachment-provided-label-type-#{ attachment.type.id }"|trans({'%date%' : attachmentDate}) }}" data-toggle="tooltip">
                            <span class="sr-only">{{ "lender-profile_lender-attachment-provided-label-type-#{ attachment.type.id }"|trans({'%date%' : attachmentDate}) }}</span>
                        </span>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </dd>
    </dl>

    <div class="btn-controls">
        <button data-target="#data-update-main-address-edit" role="button" data-toggle="collapse" data-parent="#data-update-main-address-section" class="btn-default"
                aria-controls="#data-update-main-address-edit" aria-expanded="false" type="button">
            <span class="icon fa-pencil-u32"></span>
            <span class="label">{% trans %} lender-data-update_modify-button {% endtrans %}</span>
        </button>
        <button data-target="#panel-data-update-bank-account" role="button" data-toggle="collapse" data-parent="#data-update-section" class="btn-primary data-update-continue-btn"
                aria-controls="#panel-data-update-id-doc" aria-expanded="false" type="button">
            <span class="label">{% trans %} lender-data-update_continue-button {% endtrans %}</span>
        </button>
    </div>
</section><!-- /.profile-address-view -->

<section id="data-update-main-address-edit" role="tabpanel" class="lender-data-update-edit collapse" data-formvalidation data-formvalidation-notificationselem="#data-update-main-address-edit-notifications">
    <div id="data-update-main-address-edit-notifications"></div>
    <div class="row">
        <div class="form-field {% if form.main_address.address.vars.errors|length > 0 %}ui-formvalidation-error{% endif %}">
            <label for="form-profile-address-street">{% trans %} lender-profile_information-tab-fiscal-address-section-address-label {% endtrans %}
                <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span>
            </label>
            {{ form_widget(form.main_address.address, {
                'attr': {
                    'class': 'input-field',
                    'data-formvalidation-input data-formvalidation-required': 'true',
                    'data-impacted-element-id': 'data-update-main-address-street-output'
                }
            }) }}
            {{ form_errors(form.main_address.address) }}
        </div><!-- /.form-field -->
    </div>

    <div class="row row-multi-col-computer">
        <div class="form-field col-lg-6 col-md-6 {% if form.main_address.zip.vars.errors|length > 0 %}ui-formvalidation-error{% endif %}">
            <label for="form-profile-address-code">{% trans %} lender-profile_information-tab-fiscal-address-section-zip-label {% endtrans %}
                <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span>
            </label>
            <div class="input-group set-right">
                {{ form_widget(form.main_address.zip, {
                    'id': 'form-profile-address-code',
                    'attr': {
                        'class': 'input-field',
                        'data-formvalidation-input data-formvalidation-required': 'true',
                        'data-autocomplete-address data-autocomplete-ajaxurl': path('lender_profile_ajax_zip'),
                        'data-autocomplete-address-countryelem': '#form-profile-address-pays',
                        'data-autocomplete-address-cityelem': '#form-profile-address-ville',
                        'data-autocomplete-address-zipelem': '#form-profile-address-code',
                        'data-has-spinner': '#spinner-profile-address-code',
                        'data-impacted-element-id': 'data-update-main-address-zip-output'
                    }
                }) }}
                {{ form_errors(form.main_address.zip) }}
                <div class="btn-group">
                    <span id="spinner-profile-address-code" class="ui-is-spinner"><span class="sr-only">{% trans %} common_loading {% endtrans %}</span></span>
                </div>
            </div><!-- /.input-group -->
        </div><!-- /.form-field -->
        <div class="form-field col-lg-6 col-md-6 {% if form.main_address.city.vars.errors|length > 0 %}ui-formvalidation-error{% endif %}">
            <label for="form-profile-address-ville">{% trans %} lender-profile_information-tab-fiscal-address-section-city-label {% endtrans %}
                <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span></label>
            <div class="input-group set-right">
                {{ form_widget(form.main_address.city, {
                    'id': 'form-profile-address-ville',
                    'attr': {
                        'class': 'input-field',
                        'data-formvalidation-input data-formvalidation-required': 'true',
                        'data-autocomplete-address data-autocomplete-ajaxurl': path('lender_profile_ajax_zip'),
                        'data-autocomplete-address-countryelem': '#form-profile-address-pays',
                        'data-autocomplete-address-cityelem': '#form-profile-address-ville',
                        'data-autocomplete-address-zipelem': '#form-profile-address-code',
                        'data-has-spinner': '#spinner-profile-address-city',
                        'data-impacted-element-id': 'data-update-main-address-city-output'
                    }
                }) }}
                {{ form_errors(form.main_address.city) }}
                <div class="btn-group">
                    <span id="spinner-profile-address-city" class="ui-is-spinner"><span class="sr-only">Loading...</span></span>
                </div>
            </div><!-- /.input-group -->
        </div><!-- /.form-field -->
    </div>

    <div class="row row-multi-col-computer">
        <div class="form-field col-lg-6 col-md-6 {% if form.main_address.idCountry.vars.errors|length > 0 %}ui-formvalidation-error{% endif %}">
            <label for="form-profile-address-pays">{% trans %} lender-profile_information-tab-fiscal-address-section-country-label {% endtrans %}
                <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span></label>
            {{ form_widget(form.main_address.idCountry, {
                'id': 'form-profile-address-pays',
                'attr': {
                    'class': 'input-field',
                    'data-formvalidation-input data-formvalidation-required': 'true',
                    'data-impacted-element-id': 'data-update-main-address-country-output'
                }
            }) }}
            {{ form_errors(form.main_address.idCountry) }}
        </div><!-- /.form-field -->
    </div>

    {# Show message if modifications to the saved address are made #}
    <div id="message-change-address" class="message-alert collapse" aria-hidden="true">
        <p>{% trans %} lender-profile_information-tab-fiscal-address-change-message {% endtrans %}</p>
    </div>

    {# Show if country changes from France #}
    <div id="tax-certificate" class="row collapse {% if mainAddress.getIdCountry().getIdPays() != constant('\\Unilend\\Bundle\\CoreBusinessBundle\\Entity\\PaysV2::COUNTRY_FRANCE') %} in {% endif %}">
        <div class="form-field">
            <label>{% trans %} lender-profile_information-tab-fiscal-address-tax-certificate-label {% endtrans %}
                <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span>
            </label>
            <div class="custom-input-file" id="form-profile-info-file-tax-certificate"
                 data-formvalidation-input
                 data-formvalidation-required='input[type="file"][name="tax-certificate"]'
                 data-fileattach
                 data-fileattach-inputname="tax-certificate"
                 data-fileattach-maxfiles="1"
                 data-fileattach-emptyfilelabel="{% trans %} lender-profile_information-tab-fiscal-address-tax-certificate-label {% endtrans %}"
                 data-fileattach-fileremove="false">
            </div><!-- /.ui-fileattach -->
        </div>
    </div>

    {# Proof of fiscal address (housing-certificate) #}
    <div id="form-profile-info-domicile-files-field" class="row">
        <div class="form-field">
            <label>{% trans %} lender-profile_information-tab-fiscal-address-location-certificate {% endtrans %}
                <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span>
            </label>
            <div class="custom-input-file" id="form-profile-info-file-domicile"
                 data-formvalidation-input
                 data-formvalidation-required='input[type="file"][name="housing-certificate"]'
                 data-fileattach
                 data-fileattach-inputname="housing-certificate"
                 data-fileattach-maxfiles="1"
                 data-fileattach-emptyfilelabel="{% trans %} lender-profile_information-tab-fiscal-address-location-certificate {% endtrans %}"
                 data-fileattach-fileremove="false">
            </div><!-- /.ui-fileattach -->
        </div>
    </div>

    {# Housed by Third Person #}
    <div class="row">
        <div class="form-field form-field-single-checkbox">
            {{ form_widget(form.main_address.housedByThirdPerson, {'id': 'housed-by-third-person' }) }}
            <label for="housed-by-third-person">
                <span class="label">{% trans %} lender-profile_information-tab-fiscal-address-section-housed-by-third-person-checkbox {% endtrans %}</span>
            </label>
        </div><!-- /.form-field -->
    </div>

    {# Show if housed by third person is checked #}
    <div id="upload-housed-by-third-person" class="row collapse {% if isHousedByThirdPerson == true %} in {% endif %}">
        <div class="form-field">
            <label>{% trans %} lender-profile_information-tab-fiscal-address-housed-by-third-person-declaration {% endtrans %}
                <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span>
            </label>
            <div class="custom-input-file" id="form-profile-info-file-housed-by-third-person-declaration"
                 data-formvalidation-input
                 data-formvalidation-required='input[type="file"][name="housed-by-third-person-declaration"]'
                 data-fileattach
                 data-fileattach-inputname="housed-by-third-person-declaration"
                 data-fileattach-maxfiles="1"
                 data-fileattach-emptyfilelabel="{% trans %} lender-profile_information-tab-fiscal-address-housed-by-third-person-declaration {% endtrans %}"
                 data-fileattach-fileremove="false">
            </div><!-- /.ui-fileattach -->
        </div><!-- /.form-field -->

        <div class="form-field">
            <label>{% trans %} lender-profile_information-tab-fiscal-address-id-third-person-housing {% endtrans %}
                <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span>
            </label>
            <div class="form-field file-identity-side-a">
                <div class="custom-input-file" id="form-profile-info-file-id-third-person-housing"
                     data-formvalidation-input
                     data-formvalidation-required='input[type="file"][name="id-third-person-housing"]'
                     data-fileattach
                     data-fileattach-inputname="id-third-person-housing"
                     data-fileattach-maxfiles="1"
                     data-fileattach-emptyfilelabel="{% trans %} lender-profile_information-tab-fiscal-address-id-third-person-housing {% endtrans %}"
                     data-fileattach-fileremove="false">
                </div><!-- /.ui-fileattach -->
            </div>
        </div><!-- /.form-field -->
    </div><!-- /#upload-housed-by-third-person -->

    <div class="btn-controls">
        <button class="btn-primary lender-data-update-save-btn" role="button" data-parent="#data-update-main-address-section"
                aria-controls="#data-update-main-address-view" aria-expanded="false" type="button">{% trans %} lender-data-update_save-button {% endtrans %}</button>
        <button class="btn-default" role="button" data-toggle="collapse" data-target="#data-update-main-address-view" data-parent="#data-update-main-address-section"
                aria-controls="#data-update-main-address-view" aria-expanded="false" type="reset">{% trans %} lender-data-update_cancel-button {% endtrans %}</button>
    </div>
</section><!-- /.profile-address-edit -->
