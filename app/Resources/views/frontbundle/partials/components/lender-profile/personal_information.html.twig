<article id="panel-info" class="panel">
    <header class="panel-header">
        <h3>{% trans %} lender-profile_information-tab-identity-section-title {% endtrans %}</h3>
    </header>
    <section id="profile-info-section" role="tablist" class="ui-toggle-group" aria-multiselectable="true">
        {% if client.type in [constant('\\clients::TYPE_PERSON'), constant('\\clients::TYPE_PERSON_FOREIGNER')] %}
            {{ include('partials/components/lender-profile/identity_person.html.twig') }}
        {% else %}
            {{ include('partials/components/lender-profile/identity_legal_entity.html.twig') }}
        {% endif %}
    </section><!-- /.ui-toggle-group -->
</article><!-- /.panel -->

<article id="panel-address" class="panel">
    <header class="panel-header">
        <h3>{% trans %} lender-profile_information-tab-fiscal-address-section-title {% endtrans %}</h3>
        {% if formData.errors.fiscal is not empty %}
        <div class="message-error">
            {% for error in formData.errors.fiscal %}
                {{ error }}<br>
            {% else %}
                {{ formData.successMessage.fiscal }}
            {% endfor %}
        </div>
        {% endif %}
    </header>
    <section id="profile-address-section" role="tablist" class="ui-toggle-group" aria-multiselectable="true">
        <section id="profile-address-view" role="tabpanel" class="profile-address-view collapse in">
            <a href="#profile-address-edit" role="button" data-toggle="collapse" data-parent="#profile-address-section" class="btn-edit" aria-controls="#profile-address-edit" aria-expanded="false"><span class="icon fa-pencil-u32"></span>
                <span class="label">{% trans %} lender-profile_information-tab-identity-section-modify-button {% endtrans %}</span></a>
            <dl class="list-2col">
                <dt>{% trans %} lender-profile_information-tab-fiscal-address-section-address-label {% endtrans %}</dt>
                <dd id="profile-address-street-output">{{ clientAddresses.adresse_fiscal }}</dd>
                <dt>{% trans %} lender-profile_information-tab-fiscal-address-section-zip-label {% endtrans %}</dt>
                <dd id="profile-address-code-output">{{ clientAddresses.cp_fiscal }}</dd>
                <dt>{% trans %} lender-profile_information-tab-fiscal-address-section-city-label {% endtrans %}</dt>
                <dd id="profile-address-ville-output">{{ clientAddresses.ville_fiscal }}</dd>
                <dt>{% trans %} lender-profile_information-tab-fiscal-address-section-country-label {% endtrans %}</dt>
                <dd id="profile-address-pays-output">{{ clientAddresses.id_pays_fiscal|countryLabel }}</dd>
                <dt>{% trans %} lender-profile_information-tab-fiscal-address-section-phone-label {% endtrans %}</dt>
                <dd id="profile-address-mobile-output">{{ client.mobile }}</dd>
                <dt>{% trans %} lender-profile_information-tab-fiscal-address-section-attachments {% endtrans %}</dt>
                <dd id="profile-address-fichier-domicile-output">
                    {% set isHousedByThirdPerson = false %}
                    {% for attachment in residenceAttachments %}
                        {% if attachment.id_type == constant('\\attachment_type::CNI_PASSPORT_TIERS_HEBERGEANT') %}
                            {% set isHousedByThirdPerson = true %}
                            <span id="form-profile-info-file-identite-cni-1-output" class="file-justificatif file-identity-side-a"
                                  title="{{ "lender-attachement-provided-label-type-#{ attachment.id_type }" | transchoice(attachment.added|date('d/m/Y')) }}"
                                  data-toggle="tooltip">
                                <span class="sr-only">{{ "lender-attachement-provided-label-type-#{ attachment.id_type }" | transchoice(attachment.added|date('d/m/Y'))}}</span>
                            </span>
                        {% else %}
                            <span id="form-profile-address-file-domicile-1-output" class="file-justificatif file-domicile" title="{{ "lender-attachement-provided-label-type-#{ attachment.id_type }" | transchoice(attachment.added|date('d/m/Y')) }}" data-toggle="tooltip">
                                <span class="sr-only">{{ "lender-attachement-provided-label-type-#{ attachment.id_type }" | transchoice(attachment.added|date('d/m/Y')) }}</span>
                            </span>
                        {% endif %}
                    {% endfor %}
                </dd>
            </dl>
        </section><!-- /.profile-address-view -->

        <section id="profile-address-edit" role="tabpanel" class="profile-address-edit collapse">
            <form id="form-profile-address-edit" action="{{ path('profile_address_update') }}" method="post" enctype="multipart/form-data" class="form-profile form-profile-address-edit" data-formvalidation data-formvalidation-notificationselem="#form-profile-address-notifications">
                <div id="form-profile-address-notifications"></div>
                <div class="row">
                    <div class="form-field">
                        <label for="form-profile-address-street">{% trans %} lender-profile_information-tab-fiscal-address-section-address-label {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <input id="form-profile-address-street" type="text" name="fiscal_address_street" value="{{ formData.fiscal.fiscal_address_street }}" class="input-field" placeholder="Addresse utilisée pour vos avis d'imposition {#TODO#}" data-formvalidation-input data-formvalidation-required="true"/>
                    </div><!-- /.form-field -->
                </div>

                <div class="row row-multi-col-computer">
                    <div class="form-field col-lg-6 col-md-6">
                        <label for="form-profile-address-code">{% trans %} lender-profile_information-tab-fiscal-address-section-zip-label {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <input id="form-profile-code" type="text" name="fiscal_address_zip" value="{{ formData.fiscal.fiscal_address_zip  }}" class="input-field" data-formvalidation-input data-formvalidation-required="true"/>
                    </div><!-- /.form-field -->
                    <div class="form-field col-lg-6 col-md-6">
                        <label for="form-profile-address-ville">{% trans %} lender-profile_information-tab-fiscal-address-section-city-label {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <input id="form-profile-address-ville" type="text" name="fiscal_address_city" value="{{ formData.fiscal.fiscal_address_city  }}" class="input-field" data-formvalidation-input data-formvalidation-required="true"/>
                    </div><!-- /.form-field -->
                </div>

                <div class="row row-multi-col-computer">
                    <div class="form-field col-lg-6 col-md-6">
                        <label for="form-profile-address-pays">{% trans %} lender-profile_information-tab-fiscal-address-section-country-label {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <select id="form-profile-address-pays" name="fiscal_address_country" class="input-field" data-formvalidation-input data-formvalidation-required="true">
                            {% for i, country in getCountries() %}
                                <option value="{{ i }}"{% if i == formData.fiscal.fiscal_address_country  %} selected="selected"{% endif %}>{{ country }}</option>
                            {% endfor %}
                        </select>
                    </div><!-- /.form-field -->
                    <div class="form-field col-lg-6 col-md-6">
                        <label for="form-profile-address-mobile">{% trans %} lender-profile_information-tab-fiscal-address-section-phone-label {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <div class="input-group">
                            <input id="form-profile-address-mobile" type="text" name="client_mobile" value="{{ formData.fiscal.client_mobile  }}" class="input-field" data-formvalidation-input data-formvalidation-required="true" data-formvalidation-type="telephone"/>
                        </div>
                    </div><!-- /.form-field -->
                </div>

                <div class="row">
                    <div class="form-field form-field-single-checkbox">
                        <label><input id="form-profile-address-is-correspondence" type="checkbox" name="same_postal_address" value="true"
                                      {% if formData.fiscal.same_postal_address %}checked="checked"{% endif %}>
                            <span class="label">{% trans %} lender-profile_information-tab-fiscal-address-section-postal-checkbox {% endtrans %}</span></label>
                    </div><!-- /.form-field -->
                </div>
                <div class="row">
                    <div class="form-field">
                        <label>{% trans %} lender-profile_information-tab-fiscal-address-location-certificate {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <div class="custom-input-file" id="form-profile-info-file-domicile"
                             data-fileattach data-fileattach-inputname="housing-certificate"
                             data-fileattach-maxfiles="1" >
                        </div><!-- /.ui-fileattach -->
                    </div>
                </div>

                <div class="row">
                    <div class="form-field form-field-single-checkbox">
                        <label>
                            <input id="housed-by-third-person" type="checkbox" name="housed_by_third_person" value="true" {% if formData.fiscal.housed_by_third_person %}checked="checked"{% endif %}>
                            <span class="label">{% trans %} lender-profile_information-tab-fiscal-address-section-housed-by-third-person-checkbox {% endtrans %}</span></label>
                    </div><!-- /.form-field -->
                </div>

                <div class="row" id="upload-housed-by-third-person-declaration" {% if isHousedByThirdPerson == false %} style="display: none"{% endif %}>
                    <div class="form-field ">
                        <label>{% trans %} lender-profile_information-tab-fiscal-address-housed-by-third-person-declaration {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <div class="custom-input-file" id="form-profile-info-file-housed-by-third-person-declaration"
                             data-fileattach data-fileattach-inputname="housed-by-third-person-declaration"
                             data-fileattach-maxfiles="1" >
                        </div><!-- /.ui-fileattach -->
                    </div>
                </div>
                <div class="row" id="upload-id-third-person-housing" {% if not isHousedByThirdPerson %} style="display: none"{% endif %}>
                    <div class="form-field file-identity-side-a">
                        <label>{% trans %} lender-profile_information-tab-fiscal-address-id-third-person-housing {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <div class="custom-input-file" id="form-profile-info-file-id-third-person-housing"
                             data-fileattach data-fileattach-inputname="id-third-person-housing"
                             data-fileattach-maxfiles="1">
                        </div><!-- /.ui-fileattach -->
                    </div>
                </div>

                {#<div class="row" {% if not isLivingAbroad %} style="display: none;" {% endif %} id="us-person">#}
                <div class="row" id="us-person">
                <div class="form-field form-field-single-checkbox">
                        <label>
                            <input id="form-profile-no-us-person" type="checkbox" name="no_us_person" value="true"
                                      {% if isLivingAbroad == true %}checked="checked"{% endif %}>
                            <span class="label">{% trans %} lender-profile_information-tab-fiscal-address-us-person-checkbox-label {% endtrans %}</span></label>
                    </div><!-- /.form-field -->
                    <div class="field-help">
                        <p>{% trans %} lender-profile_information-tab-fiscal-address-us-person-checkbox-message {% endtrans %}</p>
                    </div>
                </div>

                {#<div class="row" {% if not isLivingAbroad %} style="display: none;" {% endif %} id="tax-certifcate">#}
                <div class="row" id="tax-certifcate">

                <div class="form-field">
                        <label>{% trans %} lender-profile_information-tab-fiscal-address-tax-certificate-label {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <div class="custom-input-file"
                             id="form-profile-info-file-tax-domicile"
                             data-fileattach data-fileattach-inputname="tax-domicile"
                             data-fileattach-maxfiles="1">
                        </div><!-- /.ui-fileattach -->
                    </div>
                </div>

                <div class="field-help" id="message-change-address">
                    <p>{% trans %} lender-profile_information-tab-fiscal-address-change-message {% endtrans %}</p>
                </div>

                <div id="profile-address-is-correspondence" class="{% if clientAddresses.meme_adresse_fiscal != 1 %}hide{% endif %}">
                    <span class="icon fa-check-u32"></span>{% trans %} lender-profile_information-tab-fiscal-address-section-postal-checkbox {% endtrans %}
                </div>
                <input type="hidden" name="fiscal_address_form" value="true" />

                <div class="btn-controls">
                    <button class="btn-primary">{% trans %} lender-profile_information-tab-identity-save-modifications-button {% endtrans %}</button>
                    <button type="reset" role="button" data-toggle="collapse" data-target="#profile-address-view" data-parent="#profile-address-section" class="btn-default" aria-controls="#profile-address-view" aria-expanded="true">{% trans %} lender-profile_information-tab-identity-cancel-modifications-button {% endtrans %}</button>
                </div><!-- /.btn-controls -->
            </form><!-- /.form-profile-address-edit -->
        </section><!-- /.profile-address-edit -->
    </section><!-- /.ui-toggle-group -->
</article><!-- /.panel -->

{# Address Correspondence #}
<article id="panel-correspondence" class="panel collapse{% if clientAddresses.meme_adresse_fiscal != 1 %} in{% endif %}">
    <header class="panel-header">
        <h3>{% trans %} lender-profile_information-tab-postal-address-section-title {% endtrans %}</h3>
        <div>
            {{ formData.successMessage.fiscal }}
        </div>
    </header>
    <section id="profile-correspondence-section" role="tablist" class="ui-toggle-group" aria-multiselectable="true">
        <section id="profile-correspondence-view" role="tabpanel" class="profile-correspondence-view collapse in">
            <a href="#profile-correspondence-edit" role="button" data-toggle="collapse" data-parent="#profile-correspondence-section" class="btn-edit" aria-controls="#profile-correspondence-edit" aria-expanded="false"><span class="icon fa-pencil-u32"></span>
                <span class="label">{% trans %} lender-profile_information-tab-identity-section-modify-button {% endtrans %}</span></a>
            <dl class="list-2col">
                <dt>{% trans %} lender-profile_information-tab-postal-address-section-address-label {% endtrans %}</dt>
                <dd id="profile-correspondence-street-output">{{ clientAddresses.adresse1 }}</dd>
                <dt>{% trans %} lender-profile_information-tab-postal-address-section-zip-label {% endtrans %}</dt>
                <dd id="profile-correspondence-code-output">{{ clientAddresses.cp}}</dd>
                <dt>{% trans %} lender-profile_information-tab-postal-address-section-city-label {% endtrans %}</dt>
                <dd id="profile-correspondence-ville-output">{{ clientAddresses.ville }}</dd>
                <dt>{% trans %} lender-profile_information-tab-postal-address-section-country-label {% endtrans %}</dt>
                <dd id="profile-correspondence-pays-output">{{ clientAddresses.id_pays|countryLabel }}</dd>
            </dl>
        </section><!-- /.profile-correspondence-view -->

        <section id="profile-correspondence-edit" role="tabpanel" class="profile-correspondence-edit collapse">
            <form id="form-profile-correspondence-edit" action="{{ path('profile_address_update') }}" method="post" class="form-profile form-profile-correspondence-edit" data-formvalidation data-formvalidation-notificationselem="#form-profile-correspondence-notifications">
                <div id="form-profile-correspondence-notifications"></div>
                <div class="row">
                    <div class="form-field">
                        <label for="form-profile-correspondence-street">{% trans %} lender-profile_information-tab-postal-address-section-address-label {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <input id="form-profile-correspondence-street" type="text" name="postal_address_street" value="{{ formData.postal.postal_address_street }}" class="input-field" placeholder="Addresse utilisée pour vos avis d'imposition" data-formvalidation-input data-formvalidation-required="true"/>
                    </div><!-- /.form-field -->
                </div>

                <div class="row row-multi-col-computer">
                    <div class="form-field col-lg-6 col-md-6">
                        <label for="form-profile-correspondence-code">{% trans %} lender-profile_information-tab-postal-address-section-zip-label {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <input id="form-profile-correspondence-code" type="text" name="postal_address_zip" value="{{ formData.postal.postal_address_zip }}" class="input-field" data-formvalidation-input data-formvalidation-required="true"/>
                    </div><!-- /.form-field -->
                    <div class="form-field col-lg-6 col-md-6">
                        <label for="form-profile-correspondence-ville">{% trans %} lender-profile_information-tab-postal-address-section-city-label {% endtrans %}
                            <span class="field-required">*<span class="sr-only"> {% trans %} lender-profile_mandatory-field {% endtrans %}</span></span></label>
                        <input id="form-profile-correspondence-ville" type="text" name="postal_address_city" value="{{ formData.postal.postal_address_city }}" class="input-field" data-formvalidation-input data-formvalidation-required="true"/>
                    </div><!-- /.form-field -->
                </div>

                <div class="row row-multi-col-computer">
                    <div class="form-field col-lg-6 col-md-6">
                        <label for="form-profile-correspondence-pays">{% trans %} lender-profile_information-tab-postal-address-section-country-label {% endtrans %} <span class="field-required">*<span class="sr-only"> Required</span></span></label>
                        <select id="form-profile-correspondence-pays" name="postal_address_country" class="input-field" data-formvalidation-input data-formvalidation-required="true">
                            {% for i, country in getCountries() %}
                                <option value="{{ i }}"{% if i == formData.postal.postal_address_country %} selected="selected"{% endif %}>{{ country }}</option>
                            {% endfor %}
                        </select>
                    </div><!-- /.form-field -->
                </div>
                <input type="hidden" name="postal_address_form" value="true" />
                <div class="btn-controls">
                    <button class="btn-primary">{% trans %} lender-profile_information-tab-identity-save-modifications-button {% endtrans %}</button>
                    <button type="reset" role="button" data-toggle="collapse" data-target="#profile-correspondence-view" data-parent="#profile-correspondence-section" class="btn-default" aria-controls="#profile-correspondence-view" aria-expanded="true">{% trans %} lender-profile_information-tab-identity-cancel-modifications-button {% endtrans %}</button>
                </div><!-- /.btn-controls -->
            </form><!-- /.form-profile-correspondence-edit -->
        </section><!-- /.profile-correspondence-edit -->
    </section><!-- /.ui-toggle-group -->
</article><!-- /.panel -->

