{# Projet Single #}
{% extends 'layouts/_layout.html.twig' %}

{% set placeholderData = {

alloffersOverview: {
schema: [{
name: 'id',
type: 'int',
label: false
},{
name: 'interest',
type: 'string',
label: 'Taux'
},{
name: 'amount',
type: 'float',
label: 'Montant total'
},{
name: 'offers',
type: 'int',
label: 'NB offres'
},{
name: 'myoffers',
type: 'int',
label: 'Offres en cours'
},{
name: 'accepted',
type: 'int',
label: false
}],
data: [
[1, '4&ndash;4,5%', 850.15, 24, 0, 100],
[2, '4.5&ndash;5%', 923.74, 32, 1, 100],
[3, '5&ndash;5,5%', 1250.4, 64, 0, 97],
[4, '5,5&ndash;6%', 1511.12, 102, 0, 65],
[5, '6&ndash;6,5%', 2912.89, 159, 5, 49],
[6, '6,6%', 3250.74, 54, 0, 28],
[7, '6,7%', 3250.74, 64, 0, 24],
[8, '6,8%', 3250.74, 71, 0, 19],
[9, '6,9%', 3250.74, 82, 0, 15],
[10, '7%', 3250.74, 97, 0, 9],
[11, '7,1%', 3250.74, 101, 0, 2],
[12, '7,2&ndash;7,5%', 3250.74, 101, 0, 0],
[13, '7,5&ndash;8%', 3250.74, 224, 0, 0],
[14, '8&ndash;8,5%', 3250.74, 314, 0, 0],
[15, '8,5&ndash;9%', 3250.74, 396, 0, 0],
[16, '9&ndash;9,5%', 3250.74, 520, 0, 0],
[17, '9,5&ndash;10%', 3250.74, 850, 0, 0]
]
}



} %}

{# Page data #}
{% set bodyId = '' %}
{% set page= {
title: project.title,
permalink: project.slug
} %}

{# View data #}
{# Set the rating class for the .rating element #}
{% set classRating = project.risk|convertRisk|split('.')|join('-') %}

{% block siteContent %}

    <article id="project-single" class="page project-single project-category-{{ project.categoryId }}">
        <header class="project-single-header-wrap">
            {# Generate object for mapview to place marker on map #}
            {% if project.lat is defined and project.lng is defined %}
                {# Set the group based on active, expired, or offers inprogress, rejected or accepted #}
                {# @note MapView JS component & CSS relies on two groups named 'active' and 'expired' (case insensitive) #}
                {% set mapviewGroup = (listItem.daysLeft == 0 ? 'expired' : 'active') %}

                {# Set the offer status to show the icon in the marker #}
                {# @note MapView CSS relies on offerStatuses named 'inprogress', 'rejected' and 'accepted' #}
                {% set mapviewOfferStatus = '' %}
                {% if lenderOnProject is defined and lenderOnProject.bids.TotalOffers > 0 and lenderOnProject.bids.Offers is not empty %}
                    {% for statusOffer, numOffers in currentUserOffers if numOffers > 0 and statusOffer is not empty and statusOffer != 'rejected' %}
                        {% set mapviewOfferStatus = statusOffer %}
                    {% endfor %}
                {% endif %}

                {# Output map HTML #}
                <div class="project-single-map">
                    {# The MapView element #}
                    {% set mapview = {
                    target: '#project-map',
                    showFilters: false,
                    mapbox: {
                    center: [project.lat, project.lng],
                    zoom: 13
                    },
                    groups: ['all'],
                    markers: [{
                    id: 'marker' ~ project.id,
                    categoryId: project.categoryId,
                    latLng: [project.lat, project.lng],
                    title: project.title,
                    description: '<div style="font-style: italic;">' ~ project.company.city ~ ', ' ~ project.company.zip ~ '</div><div class="rating rating-' ~ classRating ~ '"><span class="sr-only">Rated ' ~ project.risk ~ ' out of 5</span></span></div>',
                    status: (project.daysLeft == 0 ? 'expired' : 'active'),
                    offerStatus: mapviewOfferStatus|default(''),
                    groupName: 'all'
                    }]
                    } %}

                    {# @note This MapView will only be initialised when it's first viewed, to reduce calls to Mapbox and lower API usage (see showProjectSingleMap function in main.dev.js) #}
                    <div id="project-map" class="project-single-map-embed">
                        <a href="javascript:;" class="btn-close ui-project-single-map-toggle"><span class="label sr-only">Close Map</span></a>
                    </div>
                    <script type="text/javascript">
                        var projectMapViewSettings = '{{ mapview|json_encode|escape('js') }}'
                    </script>
                </div><!-- /.project-single-map -->
            {% endif %}

            <div class="project-single-header">
                <div class="project-single-header-position">
                    <div class="project-single-header-inner">
                        <div class="project-single-category">
                            {{ svgimage('#category-' ~ project.categoryId, '', 160, 160) | raw }}
                        </div><!-- /.project-single-category -->

                        <div class="row">
                            <div class="col-lg-8 col-md-8">
                                <div class="project-single-details">
                                    <h1 class="project-single-title">{{ project.title }}</h1>
                                    <div class="project-single-meta">
                                        <h4 class="project-single-location"><span class="icon fa-map-marker-u16"></span>
                                            <span class="label">{{ project.company.city }}, {{ project.company.zip }}</span>{% if mapview is defined %}
                                            <a href="javascript:;" class="link ui-project-single-map-toggle">
                                                <span class="label">{% trans %} project-detail_show-map-label {% endtrans %}</span>
                                            </a>{% endif %}</h4>
                                    </div><!-- /.project-single-meta -->
                                </div><!-- /.project-single-details -->
                            </div>

                            <div class="col-lg-4 col-md-4 hide-xs">
                                <div class="project-single-rating">
                                    <div class="label">{% trans %} project-detail_unilend-rating-label {% endtrans %}</div>
                                    <span class="rating rating-{{ classRating }}"><span class="sr-only">
                                            {% trans with {'%risk%' : project.risk|convertRisk} %} project-detail_unilend-rating-wording-label {% endtrans %}</span></span>
                                </div><!-- /.project-single-rating -->
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-10 col-md-9">
                                <div class="project-single-description">
                                    {{ project.nature_project|nl2br }}
                                </div><!-- /.project-single-description -->
                            </div>
                        </div>

                        <div class="row">
                            {% if project.photo_projet is not empty %}
                                <div class="col-lg-5 col-md-4 hide-tablet-l hide-sm hide-xs">
                                    <div class="project-single-image">
                                        <img src="{{ project.photo_projet|completeProjectImagePath }}" alt="">
                                    </div><!-- /.project-single-image -->
                                </div>
                            {% endif %}

                            <div class="col-lg-5 col-md-5 col-sm-6">
                                <div class="project-single-period">
                                    <div class="project-single-period-countdown"><span class="icon fa-clock-u32"></span>
                                        <span class="ui-has-timecount" data-timecount-to="{{ project.date_retrait_full|escape('html_attr') }}">
                                            {% transchoice project.date_retrait_full with {'%time%' : project.date_retrait_full }%} project-detail_timer-count-remaining {% endtranschoice %}
                                        </span>
                                    </div>
                                    <div class="project-single-period-expires">{% trans %} project-detail_project-end-label {% endtrans %} {{ project.date_retrait_full|date('l j F Y Ã  H:i') }}</div>
                                </div><!-- /.project-single-period -->

                                <div class="project-single-offers">
                                    {% if lenderOnProject.bids.offers is defined and lenderOnProject.bids.offers.total > 0 %}
                                    {% for status, numOffers in lenderOnProject.bids.offers %}
                                        {% if status == 'inprogress' and numOffers > 0 %}
                                            <div class="project-list-item-useroffers-accepted">
                                                {{ numOffers|__num|nbsp }} {% transchoice numOffers %} project-detail_accepted-bids-label {% endtranschoice %}
                                            </div>
                                        {% elseif status == 'rejected' and numOffers > 0 %}
                                            <div class="project-list-item-useroffers-rejected">
                                                {{ numOffers|__num|nbsp }} {% transchoice numOffers %} project-detail_rejected-bids-label {% endtranschoice %}
                                            </div>
                                        {% elseif status == 'accepted' and numOffers > 0 %}
                                            <div class="project-list-item-useroffers-inprogress">
                                                {{ numOffers|__num|nbsp }} {% transchoice numOffers %} project-detail_pending-bids-label {% endtranschoice %}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                    {% endif %}

                                    <div class="project-single-offers-total">
                                        <strong>{% trans with { '%totalLenders%' : project.totalLenders|__num|nbsp }%} project-detail_offres-total-label {% endtrans %}</strong>
                                    </div>
                                </div><!-- /.project-single-offers -->

                                {# Responsive cheat #}
                                <div class="show-xs">
                                    <div class="project-single-rating">
                                        <div class="label">{% trans %} project-detail_unilend-rating-label {% endtrans %}</div>
                                        <span class="rating rating-{{ classRating }}"><span class="sr-only">
                                                {% trans with {'%risk%' : project.risk|convertRisk }%} project-detail_unilend-rating-wording-label {% endtrans %}</span></span>
                                    </div><!-- /.project-single-rating -->
                                </div><!-- /.show-xs -->
                            </div>
                        </div>
                    </div><!-- /.project-single-header-inner -->
                </div><!-- /.project-single-header-position -->
                {% if project.navigation.previousProject is defined and project.navigation.previousProject is not empty %}
                <a href="{{ path('project_detail', {'projectSlug' : project.navigation.previousProject.slug}) }}" class="btn-nav-previous" title="{{ project.navigation.previousProject.title }}" data-toggle="tooltip" data-placement="right"><span class="sr-only">{% trans %} project-detail_next-project-label {% endtrans %}</span></a>
                {%  endif %}
                {% if project.navigation.nextProject is defined %}
                <a href="{{ path('project_detail', {'projectSlug' : project.navigation.nextProject.slug}) }}" class="btn-nav-next" title="{{ project.navigation.nextProject.title }}" data-toggle="tooltip" data-placement="left"><span class="sr-only">{% trans %} project-detail_previous-project-label {% endtrans %}</span></a>
                {%  endif %}
            </div><!-- /.project-single-header -->

            {% include 'partials/components/list-socialmedia.html.twig' %}
        </header><!-- /.project-single-header-wrap -->

        {% include 'partials/components/project_details_side_panel.html.twig' %}

        <div class="project-single-menu">
            <div class="project-single-menu-inner">
                <nav class="project-single-nav">
                    <ul class="nav nav-anchors">
                        {% if project.status == constant('\\projects_status::EN_FUNDING') %}
                            <li role="presentation"><a href="#offers">{% trans %} project-detail_presentation-title-offers {% endtrans %}</a></li>
                        {% endif %}
                            <li role="presentation"><a href="#presentation">{% trans %} project-detail_presentation-title-presentation {% endtrans %}</a></li>
                        {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                            <li role="presentation"><a href="#history">{% trans %} project-detail_presentation-title-financial-accounts {% endtrans %}</a></li>
                        {% endif %}
                        {% if is_granted('IS_AUTHENTICATED_FULLY') and is_granted('ROLE_LENDER')
                        and lenderOnProject.isInvolved == true
                        and (project.status == constant('\\projects_status::FUNDE') or project.status >= constant('\\projects_status::REMBOURSEMENT')) %}
                            <li role="presentation"><a href="#info">{% trans %} project-detail_presentation-title-repayment-info {% endtrans %}</a></li>
                        {% endif %}
                    </ul>
                </nav><!-- /.project-single-nav -->

                <div class="project-single-menu-info">
                    <div class="project-single-menu-col project-single-menu-title">
                        <div class="title">{{ project.title }}</div>
                        <span class="rating rating-{{ classRating }}"><span class="sr-only">{% trans with {'%risk%' : project.risk|convertRisk }%} project-detail_unilend-rating-wording-label {% endtrans %}</span></span>
                    </div><!-- /.project-single-menu-title -->
                    <div class="project-single-menu-col project-single-menu-period">
                        <span class="icon fa-clock-u32"></span>
                        <span class="ui-has-timecount" data-timecount-to="{{ project.date_retrait_full|escape('html_attr') }}">&hellip;</span>
                    </div><!-- /.project-single-menu-period -->
                    <div class="project-single-menu-col project-single-menu-top">
                        <a href="#top" class="btn-nav-top"><span class="sr-only">Back to top</span></a>
                    </div><!-- /.project-single-menu-top -->
                </div><!-- /.project-single-menu-info -->
            </div><!-- /.project-single-nav-inner -->
        </div><!-- /.project-single-menu -->

        <div class="project-single-content page-content">
            <div class="site-wrap">
                <div class="row">
                    <div class="col-lg-8 col-md-8">

                        <nav class="project-single-nav">
                            <ul class="nav nav-anchors">
                                {% if project.status == constant('\\projects_status::EN_FUNDING') %}
                                    <li role="presentation"><a href="#offers">{% trans %} project-detail_presentation-title-offers {% endtrans %}</a></li>
                                {% endif %}
                                <li role="presentation"><a href="#presentation">{% trans %} project-detail_presentation-title-presentation {% endtrans %}</a></li>
                                {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                                    <li role="presentation"><a href="#history">{% trans %} project-detail_presentation-title-financial-accounts {% endtrans %}</a></li>
                                {% endif %}
                                {% if is_granted('IS_AUTHENTICATED_FULLY') and is_granted('ROLE_LENDER') and (project.status == constant('\\projects_status::FUNDE') or project.status >= constant('\\projects_status::REMBOURSEMENT')) %}
                                    <li role="presentation"><a href="#info">{% trans %} project-detail_presentation-title-repayment-info {% endtrans %}</a></li>
                                {% endif %}
                            </ul>
                        </nav><!-- /.project-single-nav -->
                        <div id="offers" data-watchscroll-nav>
                            {% if project.status == constant('\\projects_status::EN_FUNDING') %}
                                {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                                <section id="project-section-myoffers" class="page-section">
                                    <div class="tabs">
                                        <div class="section-tabs-nav">
                                            <header>
                                                <h3 id="project-myoffers" class="h3">{% trans %} project-detail_client-offer-table-title {% endtrans %}</h3>
                                            </header>

                                            <ul class="nav nav-tabs">
                                                <li id="project-myoffers-inprogress" role="presentation" class="active">
                                                    <a href="#myoffers-inprogress" role="tab" data-toggle="tab">{% trans %} project-detail_client-offer-table-pending {% endtrans %}</a>
                                                </li>
                                                <li id="project-myoffers-rejected" role="presentation">
                                                    <a href="#myoffers-rejected" role="tab" data-toggle="tab">{% trans %} project-detail_client-offer-table-refused {% endtrans %}</a>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section-tabs-content tab-content">
                                            <div id="myoffers-inprogress" role="tabpanel" class="tab-pane active" aria-labelledby="project-myoffers-inprogress project-myoffers">
                                                <table class="table-myoffers">
                                                    <tbody>
                                                    {% for i, item in lenderOnProject.bidsTable.data if item[3] == 1 or item[3] == 2 %}
                                                        <tr>
                                                            <td class="table-myoffers-item-id">{{ item[0] }}</td>
                                                            <td class="table-myoffers-item-interest">{{ item[1]|__num(1) }}%</td>
                                                            <td class="table-myoffers-item-amount">{{ item[2]|__num(2)|nbsp }}â¬</td>
                                                            <td class="table-myoffers-item-view">
                                                                <a href="{{ item[4] }}"><span class="icon fa-eye-u32"><span class="sr-only">View your offer</span></span></a>
                                                            </td>
                                                        </tr>
                                                    {% else %}
                                                        <tr>
                                                            <td class="table-empty" colspan="4">
                                                                <p>{% trans %} project-detail_client-offer-table-no-offers {% endtrans %}</p>
                                                                <a href="#" class="btn-primary">{% trans %} project-detail_client-offer-table-make-offer-button {% endtrans %}</a>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table><!-- /.table-myoffers -->

                                            </div><!-- /.tab-pane -->

                                            {# My Offers - Rejected #}
                                            <div id="myoffers-rejected" role="tabpanel" class="tab-pane" aria-labelledby="project-myoffers-rejected project-myoffers">

                                                <table class="table-myoffers">
                                                    <tbody>
                                                    {% for i, item in lenderOnProject.bidsTable.data if item[3] == 3 %}
                                                        <tr>
                                                            <td class="table-myoffers-item-id">{{ item[0] }}</td>
                                                            <td class="table-myoffers-item-interest">{{ item[1]|__num(1) }}%</td>
                                                            <td class="table-myoffers-item-amount">{{ item[2]|__num(2)|nbsp }}â¬</td>
                                                            <td class="table-myoffers-item-view">
                                                                <a href="{{ item[4] }}"><span class="icon fa-eye-u32"><span class="sr-only">View your offer</span></span></a>
                                                            </td>
                                                        </tr>
                                                    {% else %}
                                                        <tr>
                                                            <td class="table-empty" colspan="4">
                                                                <p>{% trans %} project-detail_client-offer-table-no-offers {% endtrans %}</p>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table><!-- /.table-myoffers -->

                                            </div><!-- /.tab-pane -->
                                        </div><!-- /.section-tabs-content -->
                                    </div><!-- /tabs -->
                                </section><!-- /.page-section -->
                                {% endif %}
                            {#{{ include('partials/components/project-bids-list.html.twig') }}#}
                            {% endif %}
                        </div>
                        <div id="presentation" data-watchscroll-nav>
                            <section id="project-section-who" class="page-section">
                                <h3 class="h3">{% trans %} project-detail_project-presentation-about-us-title {% endtrans %}</h3>
                                <p>{{ project.presentation_company|striptags }}</p>
                                <p><a href="#TODO" class="link">DÃ©couvrir le site</a></p>

                                <div class="row">
                                    <div class="col-lg-6 col-md-6 col-sm-4">
                                        <img src="{{ siteurlmedia('placeholder/projet-single-1.jpg') }}" alt="">
                                    </div>
                                    <div class="col-lg-6 col-md-6 col-sm-4">
                                        <img src="{{ siteurlmedia('placeholder/projet-single-2.jpg') }}" alt="">
                                    </div>
                                </div>
                            </section>

                            <section id="project-section-what" class="page-section">
                                <h3 class="h3">{% trans %} project-detail_project-presentation-our-project {% endtrans %}</h3>
                                <p>{{ project.objectif_loan|striptags}}</p>
                            </section><!-- /.page-section -->
                        </div>

                        {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                        <div id="history" data-watchscroll-nav>
                            {# Income history #}

                            <section id="project-section-income" class="page-section">
                                <div class="tabs">
                                    <div class="section-tabs-nav">
                                        <header>
                                            <h3 id="project-income" class="h3">{% trans %} project-detail_project-presentation-accounts-title {% endtrans %}</h3>
                                        </header>

                                        <ul class="nav nav-tabs">
                                            <li id="project-income-table" role="presentation" class="active">
                                                <a href="#income-table" role="tab" data-toggle="tab">{% trans %} project-detail_project-presentation-accounts-table-button {% endtrans %}</a></li>
                                            <li id="project-income-graph" role="presentation">
                                                <a href="#income-graph" role="tab" data-toggle="tab">{% trans %} project-detail_project-presentation-accounts-charts-button {% endtrans %}</a></li>
                                        </ul>
                                    </div><!-- /.section-tabs-nav -->

                                    <div class="section-tabs-content tab-content">
                                        <div id="income-table" role="tabpanel" class="tab-pane active" aria-labelledby="project-income-table project-income">

                                            <div class="table-scroll">
                                                <table id="income-table-data" class="table table-finance table-income">
                                                    <thead>
                                                    <tr>
                                                        <th class="table-income-item-name">&nbsp;</th>
                                                        <th class="table-income-item-year">2015</th>
                                                        <th class="table-income-item-year">2014</th>
                                                        <th class="table-income-item-year">2013</th>
                                                    </tr>
                                                    </thead>

                                                    <tbody>
                                                    {% for i, item in tables.income.data %}
                                                        <tr class="table-item">
                                                            <td class="table-income-item-name">{{ item[0] }}</td>
                                                            <td class="table-income-item-year">
                                                                <span class="amount">{{ item[1]|__num(2)|nbsp }}â¬</span>
                                                                <span class="diff">{{ item[2]|__num(2) }}%</span>
                                                            </td>
                                                            <td class="table-income-item-year">
                                                                <span class="amount">{{ item[3]|__num(2)|nbsp }}â¬</span>
                                                                <span class="diff">{{ item[4]|__num(2) }}%</span>
                                                            </td>
                                                            <td class="table-income-item-year">
                                                                {% if item[7] is defined %}
                                                                    <span class="amount">{{ item[5]|__num(2)|nbsp }}â¬</span>
                                                                    <span class="diff">{{ item[6]|__num(2) }}%</span>
                                                                {% else %}
                                                                    {{ item[5]|__num(2)|nbsp }}â¬
                                                                {% endif %}
                                                            </td>
                                                        </tr><!-- /.table-item -->
                                                    {% endfor %}
                                                    </tbody>
                                                </table><!-- /.table-income -->
                                            </div><!-- /.table-scroll -->

                                        </div><!-- /.tab-pane -->

                                        <div id="income-graph" role="tabpanel" class="tab-pane">
                                            <div class="chart" data-chartview='{{ charts.income|json_encode|escape('html_attr') }}'></div>
                                        </div>

                                    </div><!-- /.section-tabs-content -->
                                </div><!-- /tabs -->

                                <div class="btn-toolbar">
                                    <a href="{{ path('export_income_statement', {'projectId' : project.id_project }) }}" class="btn-default"><span class="icon fa-excel-u32"></span>
                                        {% trans %} project-detail_project-presentation-accounts-export-csv-button {% endtrans %}</a>
                                </div><!-- /.btn-toolbar -->

                            </section><!-- /.page-section -->

                            {# Balance history #}
                            <section id="project-section-balance" class="page-section">
                                <div class="tabs">
                                    <div class="section-tabs-nav">
                                        <header>
                                            <h3 id="project-balance" class="h3">{% trans %} project-detail_project-presentation-accounts-balance {% endtrans %}</h3>
                                        </header>

                                        <ul class="nav nav-tabs">
                                            <li id="project-balance-table" role="presentation" class="active">
                                                <a href="#balance-table" role="tab" data-toggle="tab">{% trans %} project-detail_project-presentation-accounts-table-button {% endtrans %}</a></li>
                                            <li id="project-balance-graph" role="presentation">
                                                <a href="#balance-graph" role="tab" data-toggle="tab">{% trans %} project-detail_project-presentation-accounts-charts-button {% endtrans %}</a></li>
                                        </ul>
                                    </div><!-- /.section-tabs-nav -->

                                    <div class="section-tabs-content tab-content">
                                        <div id="balance-table" role="tabpanel" class="tab-pane active" aria-labelledby="project-balance-table project-balance">

                                            <div class="table-scroll">
                                                <table id="balance-table-data" class="table table-finance table-balance">
                                                    <thead>
                                                    <tr>
                                                        <th class="table-balance-item-name">&nbsp;</th>
                                                        <th class="table-balance-item-year">2015</th>
                                                        <th class="table-balance-item-year">2014</th>
                                                        <th class="table-balance-item-year">2013</th>
                                                    </tr>
                                                    </thead>

                                                    <tbody>
                                                    {% for i, item in tables.balance.data %}
                                                        {# Entry which displays a title #}
                                                        {% if item[0] == 'title' %}
                                                            <tr class="table-item-title">
                                                                <td colspan="4">{{ item[1] }}</td>
                                                            </tr><!-- /.table-item-title -->

                                                            {# Entry which shows a total amount #}
                                                        {% elseif item[0] == 'total' %}
                                                            <tr class="table-item-total">
                                                                <td class="table-income-item-name">{{ item[1] }}</td>
                                                                <td class="table-income-item-year">
                                                                    <span class="amount">{{ item[2]|__num(2)|nbsp }}â¬</span>
                                                                    <span class="diff">{{ item[3]|__num(2) }}%</span>
                                                                </td>
                                                                <td class="table-income-item-year">
                                                                    <span class="amount">{{ item[4]|__num(2)|nbsp }}â¬</span>
                                                                    <span class="diff">{{ item[5]|__num(2) }}%</span>
                                                                </td>
                                                                <td class="table-income-item-year">
                                                                    {% if item[7] is not empty %}
                                                                        <span class="amount">{{ item[6]|__num(2)|nbsp }}â¬</span>
                                                                        <span class="diff">{{ item[7]|__num(2) }}%</span>
                                                                    {% else %}
                                                                        {{ item[6]|__num(2)|nbsp }}â¬
                                                                    {% endif %}
                                                                </td>
                                                            </tr><!-- /.table-item-total -->

                                                            {# Normal entry #}
                                                        {% else %}
                                                            <tr class="table-item">
                                                                <td class="table-income-item-name">{{ item[1] }}</td>
                                                                <td class="table-income-item-year">
                                                                    <span class="amount">{{ item[2]|__num(2)|nbsp }}â¬</span>
                                                                    <span class="diff">{{ item[3]|__num(2) }}%</span>
                                                                </td>
                                                                <td class="table-income-item-year">
                                                                    <span class="amount">{{ item[4]|__num(2)|nbsp }}â¬</span>
                                                                    <span class="diff">{{ item[5]|__num(2) }}%</span>
                                                                </td>
                                                                <td class="table-income-item-year">
                                                                    {% if item[7] is not empty %}
                                                                        <span class="amount">{{ item[6]|__num(2)|nbsp }}â¬</span>
                                                                        <span class="diff">{{ item[7]|__num(2) }}%</span>
                                                                    {% else %}
                                                                        {{ item[6]|__num(2)|nbsp }}â¬
                                                                    {% endif %}
                                                                </td>
                                                            </tr><!-- /.table-item -->
                                                        {% endif %}
                                                    {% endfor %}
                                                    </tbody>
                                                </table><!-- /.table-balance -->
                                            </div><!-- /.table-scroll -->

                                        </div><!-- /.tab-pane -->

                                        <div id="balance-graph" role="tabpanel" class="tab-pane">
                                            <div class="tabs nested-tabs">
                                                <div class="tabs-nav">
                                                    <ul class="nav nav-tabs-text">{#
                          #}
                                                        <li role="presentation" class="active">
                                                            <a href="#balance-graph-active" role="tab" data-toggle="tab">
                                                                {% trans %} project-detail_project-presentation-accounts-balance-active {% endtrans %}</a>
                                                        </li>{#
                          #}
                                                        <li role="presentation">
                                                            <a href="#balance-graph-passive" role="tab" data-toggle="tab">
                                                                {% trans %} project-detail_project-presentation-accounts-balance-passive {% endtrans %}</a>
                                                        </li>{#
                        #}</ul>
                                                </div><!-- /.tab-navigation -->
                                                <div class="tab-content">
                                                    <div id="balance-graph-active" role="tabpanel" class="tab-pane active">
                                                        <div class="chart" data-chartview='{{ charts.balanceSheetAssets|json_encode|escape('html_attr') }}'></div>
                                                    </div><!-- /.tab-pane -->
                                                    <div id="balance-graph-passive" role="tabpanel" class="tab-pane">
                                                        <div class="chart" data-chartview='{{ charts.balanceSheetDebts|json_encode|escape('html_attr') }}'></div>
                                                    </div><!-- /.tab-pane -->
                                                </div>
                                            </div><!-- /.nested-tabs -->
                                        </div><!-- /.tab-pane -->
                                    </div><!-- /.section-tabs-content -->
                                </div><!-- /tabs -->

                                <div class="btn-toolbar">
                                    <a href="{{ path('export_balance_sheet', {'projectId' : project.id_project }) }}" class="btn-default"><span class="icon fa-excel-u32"></span>
                                        {% trans %} project-detail_project-presentation-accounts-export-csv-button {% endtrans %}</a>
                                </div><!-- /.btn-toolbar -->

                            </section><!-- /.page-section -->
                        </div>
                        {% endif %}
                        <section id="project-section-help" class="page-section">
                            <h3 class="h3">{% trans %} project-detail_project-presentation-repayment-reason-title {% endtrans %}</h3>
                            <p>{{ project.means_repayment|striptags }}</p>

                            <div class="message-alert">
                                <p>{% trans %} project-detail_non-payment-warning {% endtrans %}</p>
                                <a href="{{ route('preter_guide') }}" class="link">{% trans %} project-detail_learn-more-link-under-warnings {% endtrans %}</a>
                            </div>

                            <div class="message-alert">
                                <p>{% trans %} project-detail_fiscal-information {% endtrans %}</p>
                                <a href="{{ route('fiscalite') }}" class="link">{% trans %} project-detail_learn-more-link-under-warnings {% endtrans %}</a>
                            </div>
                        </section><!-- /.page-section -->
                        {% if is_granted('IS_AUTHENTICATED_FULLY') and is_granted('ROLE_LENDER')
                        and lenderOnProject.isInvolved == true
                        and (project.status == constant('\\projects_status::FUNDE') or project.status >= constant('\\projects_status::REMBOURSEMENT')) %}
                            <div id="info" data-watchscroll-nav>
                                <section id="project-section-info" class="page-section">
                                    <p>{% trans with {'%amountUserLoan%' : lenderOnProject.loans.myLoanOnProject} %} project-detail_project-presentation-repayment-info {% endtrans %}</p>
                                    <p>
                                        {% trans with {
                                        '%amountAlreadyPaidBack%' : lenderOnProject.loans.amountAlreadyPaidBack,
                                          '%remainingToBeRepaid%' : lenderOnProject.loans.remainingToBeRepaid,
                                        '      %remainingMonths%' : lenderOnProject.loans.remainingMonths
                                        } %}
                                        project-detail_project-presentation-repayment-info-detail {% endtrans %}
                                    </p>

                                    {% if lenderOnProject.loans.amountAlreadyPaidBack > 0 %}
                                        {% for history in project.statusHistory %}
                                            {% if 'project-presentation-repayment-info-project-status-#{history.status}'|trans != 'project-presentation-repayment-info-project-status-#{history.status}' %}
                                                <p>
                                                {{ history.added|date(d/m/Y) }}
                                                    {{ 'project-presentation-repayment-info-project-status-#{history.status}'|trans }}
                                                    <br/>
                                                    {% if history.site_content is not empty %}
                                                        {{ history.content|nl2br }}
                                                        {% if history.failure == 1 %}
                                                            {% trans with {'%percentageRecovered%' : lenderOnProject.loans.percentageRecovered } %} project-detail_project-presentation-repayment-info-recovery {% endtrans %}
                                                        {% endif %}
                                                    {% endif %}
                                                </p>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                </section><!-- /.page-section -->
                            </div>
                        {% endif %}
                        <div class="project-single-info-position-end"></div>

                    </div><!-- /.col -->
                </div><!-- /.row -->

            </div><!-- /.site-wrap -->
        </div><!-- /.project-single-content -->

    </article>

{% endblock %}
