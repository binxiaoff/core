var $trancheCollectionHolder = $('div.tranches');

var $addTrancheButton = $(
    '<a href="javascript:;" class="btn-default btn-shape-sq-md margin-10-t" data-action="ui-form-lending-tranche-add">' +
    '    <span class="icon fa-plus-u16 c-t2"></span>' +
    '</a>'
);

$trancheCollectionHolder.append($addTrancheButton);

$trancheCollectionHolder.data('index', $trancheCollectionHolder.find(':input').length);

$addTrancheButton.on('click', function () {
    addTrancheForm($trancheCollectionHolder, $addTrancheButton);
});

function addTrancheForm($trancheCollectionHolder, $addTrancheButton) {
    var prototype = $trancheCollectionHolder.data('prototype');
    var index = $trancheCollectionHolder.data('index');
    var newForm = prototype;

    newForm = newForm.replace(/__name__/g, index);

    $trancheCollectionHolder.data('index', index + 1);

    var $newFormDiv = $('<div class="row row-multi-col-computer"></div>').append(newForm);
    $addTrancheButton.before($newFormDiv);
    var $removeFormButton = $('<div class="form-field col-lg-2 col-md-2"><button type="button" class="btn-default btn-shape-xxs">' + {% trans %} 'global-form.delete' {% endtrans %} + '</button></div>');
    $newFormDiv.append($removeFormButton);

    $removeFormButton.on('click', function () {
        $newFormDiv.remove();
    });
}
