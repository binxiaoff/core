{% extends 'demo/_layout.html.twig' %}

{% set page = {
    id: 'demo-project-request-details',
    classNames: ''
} %}

{% block dashboardContent %}
    <section class="dashboard-tabs tabs">
        <h4>
            {{ project.idCompany.name }}
            <small>
                {% if isEditable %}
                    <a href="#" id="title" class="editable" data-type="text" data-inputclass="input-field">{{ project.title }}</a>
                {% else %}
                    {{ project.title }}
                {% endif %}
            </small>
            <div class="bubble pull-right">
                {% include 'partials/market_bubble.html.twig' with {'partner': project.idPartner.label} %}
            </div>
        </h4>
        <div class="row dashboard-tab-pane">
            <div id="project-breadcrumb" class="form-project-create-nav tab-nav">
                <div class="{% if project.status > constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_REQUESTED') %}complete{% else %}active{% endif %}">Dépôt</div>
                <div class="{% if project.status > constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_PUBLISHED') %}complete{% elseif project.status == constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_PUBLISHED') %}active{% endif %}">Financement</div>
                <div class="{% if project.status > constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_FUNDED') %}complete{% elseif project.status == constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_FUNDED') %}active{% endif %}">Contractualisation</div>
                <div class="{% if project.status > constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_CONTRACTS_REDACTED') %}complete{% elseif project.status == constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_CONTRACTS_REDACTED') %}active{% endif %}">Signature</div>
                <div class="{% if project.status > constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_CONTRACTS_SIGNED') %}complete{% elseif project.status == constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_CONTRACTS_SIGNED') %}active{% endif %}">Remboursement</div>
                <div class="{% if project.status in [constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_FINISHED'), constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_LOST')] %}complete{% endif %}">Terminé</div>
            </div><!-- /.form-project-create-nav -->
        </div>
        <div class="dashboard-tabs-content tab-content">
            <div class="row">
                <article class="dashboard-tab-pane col-lg-8 col-md-8">
                    <div class="panel" data-equal-height>
                        <div class="panel-content">
                            <div class="row columns-with-space">
                                <dl class="col-md-6 col-lg-6">
                                    <dt>Montant</dt>
                                    <dd data-fee-reference-amount>
                                        {% if isEditable %}
                                            <a href="#" id="amount" class="editable" data-type="text" data-inputclass="input-field">{{ project.amount|localizednumber }}</a>&nbsp;€
                                        {% else %}
                                            {{ project.amount|localizednumber }}&nbsp;€
                                        {% endif %}
                                    </dd>
                                </dl>
                                <dl class="col-md-6 col-lg-6">
                                    <dt>Durée</dt>
                                    <dd>
                                        {% if isEditable %}
                                            <a href="#" id="duration" data-type="select">
                                                {% transchoice(project.period / 12) with {'%duration%': project.period / 12} %} demo-project-request_simulator-duration-select-option {% endtranschoice %}
                                            </a>
                                        {% else %}
                                            {% transchoice(project.period / 12) with {'%duration%': project.period / 12} %} demo-project-request_simulator-duration-select-option {% endtranschoice %}
                                        {% endif %}
                                    </dd>
                                </dl>
                            </div>
                            <div class="row columns-with-space margin-10-t">
                                <dl class="col-md-6 col-lg-6">
                                    <dt>Loi d‘amortissement</dt>
                                    <dd>
                                        {% if isEditable %}
                                            <a href="#" id="amortization" data-type="select">
                                                {% if product %}{{ ('amortization-name_' ~ product.idRepaymentType.label)|trans }}{% endif %}
                                            </a>
                                        {% elseif product %}
                                            {{ ('amortization-name_' ~ product.idRepaymentType.label)|trans }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </dd>
                                </dl>
                                <dl class="col-md-6 col-lg-6">
                                    <dt>Périodicité</dt>
                                    <dd>
                                        {% if isEditable %}
                                            <a href="#" id="periodicity" data-type="select">
                                                {% if product.idRepaymentType.periodicity %}{{ ('periodicity_' ~ product.idRepaymentType.periodicity ~ '-months')|trans }}{% endif %}
                                            </a>
                                        {% elseif product.idRepaymentType.periodicity %}
                                            {{ ('periodicity_' ~ product.idRepaymentType.periodicity ~ '-months')|trans }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </dd>
                                </dl>
                            </div>
                            <div class="row columns-with-space margin-10-t">
                                <dl class="col-md-6 col-lg-6">
                                    <dt>Date de dépôt</dt>
                                    <dd>{{ project.added|localizeddate('short', 'short') }}</dd>
                                </dl>
                                <dl class="col-md-6 col-lg-6">
                                    <dt>Date butoir de réponse</dt>
                                    <dd>
                                        {% if isEditable %}
                                            <a href="#" id="response-date" class="editable" data-type="text" data-pk="{{ project.idProject }}" data-inputclass="input-field">
                                                {% if project.datePublication %}{{ project.datePublication|localizeddate('short', 'none') }}{% endif %}
                                            </a>
                                        {% elseif project.datePublication %}
                                            {{ project.datePublication|localizeddate('short', 'none') }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </dd>
                                </dl>
                            </div>
                            <div class="row columns-with-space margin-10-t">
                                <dl class="col-md-6 col-lg-6">
                                    <dt>Date de mise à disposition</dt>
                                    <dd>
                                        {% if isEditable %}
                                            <a href="#" id="release-date" class="editable" data-type="text" data-pk="{{ project.idProject }}" data-inputclass="input-field">
                                                {% if project.dateRetrait %}{{ project.dateRetrait|localizeddate('short', 'none') }}{% endif %}
                                            </a>
                                        {% elseif project.dateRetrait %}
                                            {{ project.dateRetrait|localizeddate('short', 'none') }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </dd>
                                </dl>
                                <dl class="col-md-6 col-lg-6">
                                    <dt>Date de 1<sup>ère</sup> échéance</dt>
                                    <dd>
                                        {% if isEditable %}
                                            <a href="#" id="first-payment-date" class="editable" data-type="text" data-pk="{{ project.idProject }}" data-inputclass="input-field">
                                                {% if project.dateFunded %}{{ project.dateFunded|localizeddate('short', 'none') }}{% endif %}
                                            </a>
                                        {% elseif project.dateFunded %}
                                            {{ project.dateFunded|localizeddate('short', 'none') }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </dd>
                                </dl>
                            </div>
                            {#<div class="row margin-10-t">
                                <dt>Ce dossier fait déjà l‘objet d‘une demande de garantie auprès de FONCARIS</dt>
                                <dd>
                                    {% if isEditable %}
                                        <a href="#" id="has-guarantee" data-type="checklist" data-value="{{ project.fondsPropresDeclaraClient ? '1' : '' }}"></a>
                                    {% elseif project.fondsPropresDeclaraClient %}
                                        Oui
                                    {% else %}
                                        Non
                                    {% endif %}
                                </dd>
                            </div>#}
                            <h4 class="h4 margin-20-t">
                                Description
                                {% if isEditable %}
                                    <a href="#" id="edit-description"><span class="icon fa-edit-u32"></span></a>
                                {% endif %}
                            </h4>
                            <div class="row description-container">
                                <em>
                                    {% if isEditable %}
                                        <span href="#" id="description" class="editable" data-type="textarea" data-toggle="manual" data-inputclass="input-field">{{ project.description }}</span>
                                    {% else %}
                                        {{ project.description|nl2br }}
                                    {% endif %}
                                </em>
                            </div>
                        </div><!-- /.panel-content -->
                    </div><!-- /.panel -->
                </article><!-- /.dashboard-tab-pane -->
                <article class="dashboard-tab-pane col-lg-4 col-md-4" style="border-left: solid 2px #eceaed;">
                    <div class="panel" style="position: relative;" data-equal-height>
                        <h3 class="margin-10-t">Raccourcis</h3>
                        <div class="panel-content">
                            <ul>
                                <li><a href="#article-scoring">Notation</a></li>
                                {#<li><a href="#article-fees">Frais / commissions</a></li>#}
                                <li><a href="#article-visibility">Visibilité</a></li>
                                {% if project.status >= constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_PUBLISHED') %}
                                    <li><a href="#article-bids">Offres de participation</a></li>
                                {% endif %}
                                <li><a href="#article-documents">Documents</a></li>
                                <li><a href="#article-discussions">Discussions</a></li>
                            </ul>
                            <div class="row" style="position: absolute; bottom: 30px; left: 30px; right: 30px;">
                                {% if project.status <= constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_FUNDED') %}
                                    <a href="{{ path('demo_project_abandon', {'hash': project.hash}) }}" class="btn-default btn-shape-xs margin-10-t" style="width: 100%;">Abandonner le dossier</a>
                                {% endif %}
                                {% if project.status == constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_REQUESTED') %}
                                    <a href="{{ path('demo_project_publish', {'hash': project.hash}) }}" class="btn-primary btn-shape-xs margin-10-t" style="width: 100%;">Proposer au financement</a>
                                {% endif %}
                                {% if project.status == constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_PUBLISHED') %}
                                    <a href="{{ path('demo_project_fund', {'hash': project.hash}) }}" class="btn-primary btn-shape-xs margin-10-t" style="width: 100%;">Clôturer la syndication</a>
                                {% endif %}
                                {% if project.status == constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_FUNDED') %}
                                    <a href="{{ path('demo_project_sign', {'hash': project.hash}) }}" class="btn-primary btn-shape-xs margin-10-t" style="width: 100%;">Signer les contrats</a>
                                {% endif %}
                                {% if project.status == constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_CONTRACTS_REDACTED') %}
                                    <a href="{{ path('demo_project_repay', {'hash': project.hash}) }}" class="btn-primary btn-shape-xs margin-10-t" style="width: 100%;">Commencer le remboursement</a>
                                {% endif %}
                                {% if project.status == constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_CONTRACTS_SIGNED') %}
                                    <a href="{{ path('demo_project_repaid', {'hash': project.hash}) }}" class="btn-primary btn-shape-xs margin-10-t" style="width: 100%;">Mettre fin au remboursement</a>
                                    <a href="{{ path('demo_project_loss', {'hash': project.hash}) }}" class="btn-primary btn-shape-xs margin-10-t" style="width: 100%;">Passer en perte</a>
                                {% endif %}
                            </div>
                        </div><!-- /.panel-content -->
                    </div><!-- /.panel -->
                </article><!-- /.dashboard-tab-pane -->
            </div><!-- /.row -->
            <article class="dashboard-tab-pane" id="article-scoring">
                <div class="panel">
                    <fieldset>
                        <h3 class="margin-10-t">Notation</h3>
                        <div class="row row-multi-col-computer scoring">
                            <dl class="col-md-4 col-lg-4">
                                <dt>Arrangeur</dt>
                                <dd>
                                    {% if isEditable %}
                                        <a href="#" id="arranger" data-type="select">
                                            {% if arranger %}{{ arranger.name }}{% endif %}
                                        </a>
                                    {% elseif arranger %}
                                        {{ arranger.name }}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </dd>
                            </dl>
                            <dl class="col-md-4 col-lg-4">
                                <dt>RUN</dt>
                                <dd>
                                    {% if isEditable %}
                                        <a href="#" id="run" data-type="select">
                                            {% if run %}
                                                {{ run.name }}
                                            {% endif %}
                                        </a>
                                    {% elseif run %}
                                        {{ run.name }}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </dd>
                            </dl>
                            <dl class="col-md-4 col-lg-4">
                                <dt>Note</dt>
                                <dd>
                                    {% if isScoringEditable %}
                                        <a href="#" class="editable" id="scoring" data-type="text" data-inputclass="input-field">
                                            {% if project.natureProject is not empty %}
                                                {{ project.natureProject }}
                                            {% endif %}
                                        </a>
                                    {% elseif project.natureProject is not empty %}
                                        {{ project.natureProject }}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </dd>
                            </dl>
                        </div>
                    </fieldset>
                </div>
            </article><!-- /.dashboard-tab-pane -->
            {#<article class="dashboard-tab-pane" id="article-fees">
                <div class="panel">
                    <h3 class="margin-10-t">Frais / commissions</h3>
                    {% if project.projectPercentFees is not empty %}
                        <table class="table-myoffers">
                            <tbody>
                            <tr class="my-offers-bid-row">
                                <td>Type</td>
                                <td>Taux</td>
                                <td>Récurrent</td>
                                <td></td>
                            </tr>
                            {% for projectPercentFee in project.projectPercentFees %}
                                <tr>
                                    <td>{{ ('fee-type_' ~ projectPercentFee.percentFee.type.label)|trans }}</td>
                                    <td>{{ projectPercentFee.percentFee.rate|localizednumberwithprecision(2) }}
                                        &nbsp;%{% if projectPercentFee.percentFee.isRecurring == false %}&nbsp;(soit {{ (projectPercentFee.percentFee.rate * project.amount / 100)|localizedcurrency('EUR') }}){% endif %}</td>
                                    <td>{% if projectPercentFee.percentFee.isRecurring %} Oui {% else %} Non {% endif %}</td>
                                    <td><a href="{{ path('demo_remove_project_fees', {hash: project.hash, projectPercentFee: projectPercentFee.id}) }}">Annuler</a></td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table><!-- /.table-myoffers -->
                    {% else %}
                        <div class="message-info">Vous n‘avez aucun frais associé à votre dossier.</div>
                    {% endif %}
                    <h5 class="h4 margin-20-t">Ajouter des frais ou commissions</h5>
                    {% set feesTemplate = include('partials/fees/new_project_fees.html.twig') %}
                    <div class="row row-multi-col-computer fees" data-prototype="{{ feesTemplate|e('html_attr') }}"></div>
                </div>
            </article><!-- /.dashboard-tab-pane -->#}
            <article class="dashboard-tab-pane" id="article-visibility">
                <div class="panel">
                    <form action="{{ path('demo_project_visibility', {'hash': project.hash}) }}" method="post">
                        <h3 class="margin-10-t">Visibilité</h3>
                        {% if isEditable %}
                            <div class="row">
                                <div class="message-info">Sélectionnez les entités qui auront la possibilité de se positionner pour le financement du projet. Une fois le projet en cours de financement, vous ne pourrez plus retirer d‘entité de la liste.</div>
                            </div>
                            <div class="row">
                                <label>
                                    <input id="visibility-crca" type="checkbox">
                                    Caisses régionales
                                </label>
                                <label>
                                    <input type="checkbox">
                                    Amicale de l’Ouest
                                </label>
                                <label>
                                    <input type="checkbox">
                                    Amicale du Sud
                                </label>
                                <label>
                                    <input type="checkbox">
                                    Amicale du Centre
                                </label>
                                <label>
                                    <input type="checkbox">
                                    Amicale Nord & Est
                                </label>
                                <label>
                                    <input type="checkbox" value="45">
                                    LCL
                                </label>
                            </div>
                            <hr>
                        {% endif %}
                        <div class="row">
                            {% set lendersByColumn = (regionalBanks|length / 3)|round(0, 'ceil') %}
                            <div class="col-lg-4 col-md-4">
                                {% for lender in regionalBanks %}
                                    {% if loop.index <= lendersByColumn %}
                                        <div>
                                            <label>
                                                <input type="checkbox" name="visibility[]" value="{{ lender.idCompany }}" class="visibility-bank visibility-bank-crca"
                                                    {% if lender.idCompany in visibility %} checked{% endif %}
                                                    {% if
                                                        false == isEditable
                                                        or arranger is not empty and arranger.idCompany == lender.idCompany
                                                        or run is not empty and run.idCompany == lender.idCompany
                                                    %} disabled{% endif %}>
                                                {{ lender.name }}
                                            </label>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <div class="col-lg-4 col-md-4">
                                {% for lender in regionalBanks %}
                                    {% if loop.index > lendersByColumn and loop.index <= 2 * lendersByColumn %}
                                        <div>
                                            <label>
                                                <input type="checkbox" name="visibility[]" value="{{ lender.idCompany }}" class="visibility-bank visibility-bank-crca"
                                                    {% if lender.idCompany in visibility %} checked{% endif %}
                                                    {% if
                                                        false == isEditable
                                                        or arranger is not empty and arranger.idCompany == lender.idCompany
                                                        or run is not empty and run.idCompany == lender.idCompany
                                                    %} disabled{% endif %}>
                                                {{ lender.name }}
                                            </label>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <div class="col-lg-4 col-md-4">
                                {% for lender in regionalBanks %}
                                    {% if loop.index > 2 * lendersByColumn %}
                                        <div>
                                            <label>
                                                <input type="checkbox" name="visibility[]" value="{{ lender.idCompany }}" class="visibility-bank visibility-bank-crca"
                                                    {% if lender.idCompany in visibility %} checked{% endif %}
                                                    {% if
                                                        false == isEditable
                                                        or arranger is not empty and arranger.idCompany == lender.idCompany
                                                        or run is not empty and run.idCompany == lender.idCompany
                                                    %} disabled{% endif %}>
                                                {{ lender.name }}
                                            </label>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        {% if isEditable %}
                            <div class="row margin-20-t text-align-right">
                                <button type="submit" class="btn-primary btn-shape-xs" data-spinnerbutton>Modifier la visibilité</button>
                            </div>
                       {% endif %}
                    </form>
                </div>
            </article><!-- /.dashboard-tab-pane -->
            {% if project.status >= constant('\\Unilend\\Entity\\ProjectsStatus::STATUS_PUBLISHED') %}
                <article class="dashboard-tab-pane" id="article-bids">
                    <div class="panel">
                        <div class="panel-content">
                            <h3 class="margin-10-t">Offres de participation</h3>
                            {% include 'partials/bids/bids_list.html.twig' with {bids: project.bids} %}
                        </div><!-- /.project-single-content -->
                    </div>
                </article><!-- /.dashboard-tab-pane -->
            {% endif %}
            <article class="dashboard-tab-pane" id="article-documents">
                <div class="panel">
                    <form action="{{ path('demo_project_details_upload', {'hash': project.hash}) }}" method="post" enctype="multipart/form-data" data-formvalidation data-formvalidation-shownotifications="false">
                        <fieldset>
                            <h3 class="margin-10-t">Documents</h3>
                            {% for projectAttachment in projectAttachments %}
                                <div class="row">
                                    <span class="icon fa-file-u"></span>
                                    <a href="{{ path('demo_project_document', {'hash': project.hash, 'idProjectAttachment': projectAttachment.id}) }}">
                                        {{ projectAttachment.attachment.originalName }}
                                    </a>
                                    <small>({{ projectAttachment.attachment.added|localizeddate('short', 'short') }})</small>
                                </div>
                            {% else %}
                                <div class="message-info">Vous n‘avez aucun document associé à votre dossier.</div>
                            {% endfor %}
                            <h5 class="h4 margin-20-t">Ajouter des documents</h5>
                            <div class="form-extrafiles-list">
                                <div class="form-field form-field-multi file-upload-extra row row-multi-col-computer" data-formvalidation-input data-formvalidation-required="true" data-formvalidation-type="typedFile">
                                    <div class="col-lg-4 col-md-4">
                                        {% include 'demo/partials/project_attachment_select.html.twig' with {'name': 'file'} %}
                                    </div>
                                    <div class="col-lg-4 col-md-4">
                                        <input type="text" name="filename[file]" placeholder="Nom du fichier" class="input-field">
                                    </div>
                                    <div class="col-lg-4 col-md-4">
                                        <div class="custom-input-file" id="form-file" data-fileattach data-fileattach-inputname="file" data-fileattach-maxfiles="1" data-fileattach-filetypes="pdf jpg jpeg png doc docx" data-formvalidation-required='input[type="file"][name="file[0]"]' aria-labelledby="form-extrafiles-document-file-label"></div><!-- /.ui-fileattach -->
                                    </div>
                                </div>
                            </div><!-- /.form-extrafiles-list -->
                            <a href="javascript:;" class="btn-default btn-shape-sq-md ui-form-extrafiles-add">
                                <span class="icon fa-plus-u16 c-t2"></span>
                                <span class="sr-only">Ajouter un document</span>
                            </a>
                        </fieldset><!-- /.form-project-details-fieldset -->
                        <div class="text-align-right">
                            <button type="submit" class="btn-primary btn-shape-xs" data-spinnerbutton>Charger</button>
                        </div>
                    </form>

                    <div id="form-extrafiles-template" class="ui-template-definition" style="display: none" disabled="disabled" aria-hidden="true">
                        <div class="form-field form-field-multi file-upload-extra row row-multi-col-computer" data-formvalidation-input data-formvalidation-required="true" data-formvalidation-type="typedFile">
                            <div class="col-lg-4 col-md-4">
                                {% include 'demo/partials/project_attachment_select.html.twig' with {'name': '__NUM__'} %}
                            </div>
                            <div class="col-lg-4 col-md-4">
                                <input type="text" name="filename[extra__NUM__]" placeholder="Nom du fichier" class="input-field">
                            </div>
                            <div class="col-lg-4 col-md-4">
                                <div class="custom-input-file" id="form-file" data-fileattach data-fileattach-inputname="extra__NUM__" data-fileattach-maxfiles="1" data-fileattach-filetypes="pdf jpg jpeg png doc docx" data-formvalidation-required='input[type="file"][name="file[0]"]' aria-labelledby="form-extrafiles-document-file-label"></div><!-- /.ui-fileattach -->
                            </div>
                        </div>
                    </div><!-- /.ui-template-definition -->
                </div>
            </article><!-- /.dashboard-tab-pane -->
            <article class="dashboard-tab-pane" id="article-discussions">
                <div class="panel" style="font-size: 16px;">
                    <h3 class="margin-10-t">Discussions</h3>
                    <div id="comments-container"></div>
                </div>
            </article>
        </div><!-- /.dashboard-tabs-content -->
    </section><!-- /.dashboard-tabs -->
{% endblock %}

{% block pageHeadScripts %}
    <link href="{{ asset('js/vendor/jquery-comments/jquery-comments.css', 'gulp') }}" rel="stylesheet"/>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/jquery-editable/css/jquery-editable.css" rel="stylesheet"/>
    <link href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/css/bootstrap-datepicker.min.css" rel="stylesheet"/>
    <style>
        a.editable-click {
            color: #302a32 !important;
            border-bottom: dashed 1px #302a32;
        }

        a.editable-click:hover {
            border-bottom: dashed 1px #2bc9af;
        }

        h4 a.editable-click {
            color: #2bc9af !important;
            border-bottom: dashed 1px #2bc9af;
        }

        h4 a.editable-click:hover {
            border-bottom: dashed 1px #302a32;
        }

        .description-container {
            line-height: 18px;
        }

        .description-container .editable-container.editable-inline,
        .description-container .editable-input {
            width: 100%;
        }

        .bubble {
            display: inline-block;
            border-radius: 12px;
            padding: 3px 10px;
            line-height: 18px;
            color: #fbf9fb;
            font-size: 13px;
            font-weight: 900;
        }

        dt {
            font-weight: 700;
        }

        dd {
            font-size: 16px;
        }

        #project-breadcrumb {
            text-align: center;
            display: flex;
            margin: 0 0 22px 0;
        }

        #project-breadcrumb div {
            display: block;
            flex: 1;
            float: left;
            height: 40px;
            background: #c5eee4;
            text-align: center;
            padding: 10px 0 0 40px;
            position: relative;
            margin: 0 10px 0 0;
            font-size: 16px;
            text-decoration: none;
            color: #fff;
        }

        #project-breadcrumb div:after {
            content: "";
            border-top: 25px solid transparent;
            border-bottom: 25px solid transparent;
            border-left: 25px solid #c5eee4;
            position: absolute;
            right: -25px;
            top: 0;
            z-index: 1;
        }

        #project-breadcrumb div:before {
            content: "";
            border-top: 25px solid transparent;
            border-bottom: 25px solid transparent;
            border-left: 25px solid #eceaed;
            position: absolute;
            left: 0;
            top: 0;
        }

        #project-breadcrumb div:first-child {
            padding-left: 22px;
        }

        #project-breadcrumb div:first-child:before {
            display: none;
        }

        #project-breadcrumb div:last-child {
            margin-right: 0;
            padding-right: 26px;
        }

        #project-breadcrumb div:last-child:after {
            display: none;
        }

        #project-breadcrumb div.active {
            background: #2bc9af;
        }

        #project-breadcrumb div.active:after {
            border-left-color: #2bc9af;
        }

        #project-breadcrumb div.complete {
            background: #2ba48f;
        }

        #project-breadcrumb div.complete:after {
            border-left-color: #2ba48f;
        }

        .risk-analysis-container .editable-container,
        .risk-analysis-container .editable-container .editable-input {
            width: 100%;
        }

        #comments-container ul > li {
            list-style: none;
        }

        #comments-container .control-row .delete {
            display: none;
        }
    </style>
{% endblock %}

{% block pageScripts %}
    <script src="{{ asset('js/vendor/jquery-comments/jquery-comments.min.js', 'gulp') }}"></script>
    <script src="{{ asset('js/vendor/jquery.poshytip.min.js', 'gulp') }}"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/jquery-editable/js/jquery-editable-poshytip.js"></script>
    <script>{% include 'partials/bids/actions.js.twig' %}</script>
    <script>{% include 'partials/fees/fees.js.twig' %}</script>
    <script>
        $(function () {
            $.fn.editable.defaults.mode = 'inline'

            var editableConfig = {
                pk: {{ project.idProject }},
                url: '{{ path('demo_project_update', {'hash': project.hash}) }}',
                success: function (response) {
                    if (response.newValue)
                        return {
                            newValue: response.newValue
                        }
                },
                onblur: 'submit',
                showbuttons: false,
                emptytext: 'Non défini'
            }

            $('.editable').editable(editableConfig)

            $('#duration').editable(Object.assign(editableConfig, {
                value: '{{ project.period / 12 }}',
                source: [
                    {value: '', text: ''},
                    {% for duration in loanPeriods %}
                    {value: '{{ duration }}', text: '{% transchoice(duration) with {"%duration%": duration} %} demo-project-request_simulator-duration-select-option {% endtranschoice %}'},
                    {% endfor %}
                ]
            }))

            $('#amortization').editable(Object.assign(editableConfig, {
                value: '{{ product.idRepaymentType.label }}',
                source: [
                    {value: '', text: ''},
                    {value: '{{ constant('Unilend\\Entity\\RepaymentType::REPAYMENT_TYPE_FIXED_PAYMENT') }}', text: 'Échéances constantes'},
                    {value: '{{ constant('Unilend\\Entity\\RepaymentType::REPAYMENT_TYPE_FIXED_CAPITAL') }}', text: 'Capital constant'},
                    {value: '{{ constant('Unilend\\Entity\\RepaymentType::REPAYMENT_TYPE_DEFERRED') }}', text: 'Différé'},
                    {value: '{{ constant('Unilend\\Entity\\RepaymentType::REPAYMENT_TYPE_IN_FINE') }}', text: 'In fine'},
                ]
            }))

            $('#periodicity').editable(Object.assign(editableConfig, {
                value: '{{ product.idRepaymentType.periodicity }}',
                source: [
                    {value: '', text: ''},
                    {value: '1', text: 'Mensuel'},
                    {value: '3', text: 'Trimestriel'},
                    {value: '6', text: 'Semestriel'},
                    {value: '12', text: 'Annuel'},
                ]
            }))

            $('#edit-description').on('click', function (event) {
                event.stopPropagation()
                event.preventDefault()
                $('#description').editable('toggle')
            })

            $('#arranger').editable(Object.assign(editableConfig, {
                value: '{% if arranger %}{{ arranger.idCompany }}{% endif %}',
                source: [
                    {value: '', text: ''},
                    {% for arrangerId, arrangerName in arrangers %}
                    {value: {{ arrangerId }}, text: '{{ arrangerName|e('js') }}'},
                    {% endfor %}
                ]
            }))

            $('#run').editable(Object.assign(editableConfig, {
                value: '{% if run %}{{ run.idCompany }}{% endif %}',
                source: [
                    {value: '', text: ''},
                    {% for runCompany in runs %}
                    {value: {{ runCompany.idCompany }}, text: '{{ runCompany.name|e('js') }}'},
                    {% endfor %}
                ]
            }))

            $('#has-guarantee').editable(Object.assign(editableConfig, {
                placement: 'right',
                source: [
                    {value: 1, text: 'Oui'}
                ],
                emptytext: 'Non'
            }))

            $('#visibility-crca').on('change', function () {
                $('.visibility-bank-crca').not(':disabled').prop('checked', $(this).is(':checked'))
            })

            $('#comments-container').comments({
                currentUserId: {{ app.user.idClient }},
                textareaPlaceholderText: 'Ajouter un commentaire',
                newestText: 'Récents',
                oldestText: 'Anciens',
                popularText: '',
                attachmentsText: 'Documents',
                sendText: 'Commenter',
                replyText: 'Répondre',
                editText: 'Éditer',
                editedText: 'Modifié',
                youText: 'Vous',
                saveText: 'Enregistrer',
                deleteText: 'Supprimer',
                viewAllRepliesText: 'Voir toutes les réponse (__replyCount__)',
                hideRepliesText: 'Masquer',
                noCommentsText: 'Aucun commentaire',
                noAttachmentsText: 'Aucun document',
                attachmentDropText: 'Déposez vos fichiers ici',
                highlightColor: '#2bc9af',
                deleteButtonColor: '#eceaed',
                enableReplying: true,
                enableEditing: true,
                enableUpvoting: false,
                enableDeleting: false,
                enableDeletingCommentWithReplies: false,
                enableAttachments: false, // @todo may be interesting in the future
                enableHashtags: false, // @todo may be interesting in the future
                enablePinging: false, // @todo may be interesting in the future
                enableNavigation: true,
                postCommentOnEnter: false,
                forceResponsive: false,
                readOnly: false,
                getComments: function(success, error) {
                    let commentsArray = [{% for comment in project.comments %}{
                        id: {{ comment.id }},
                        parent: {% if comment.parent %}{{ comment.parent.id }}{% else %}null{% endif %},
                        created: '{{ comment.added|date('c') }}',
                        modified: '{% if comment.updated %}{{ comment.updated|date('c') }}{% else %}{{ comment.added|date('c') }}{% endif %}',
                        content: '{{ comment.content|raw|e('js') }}',
                        fullname: '{{ comment.client.firstName }} {{ comment.client.lastName }}',
                        created_by_current_user: {% if app.user == comment.client %}true{% else %}false{% endif %}
                    },{% endfor %}]
                    success(commentsArray)
                },
                postComment: function(commentJSON, success, error) {
                    let userId = this.currentUserId

                    $.ajax({
                        type: 'post',
                        url: '{{ path('demo_project_comment_add', {'hash': project.hash}) }}',
                        data: {
                            user: userId,
                            content: commentJSON.content,
                            parent: commentJSON.parent
                        },
                        success: function(comment) {
                            success(comment)
                        },
                        error: error
                    })
                },
                putComment: function(commentJSON, success, error) {
                    $.ajax({
                        type: 'post',
                        url: '{{ path('demo_project_comment_update') }}',
                        data: {
                            id: commentJSON.id,
                            content: commentJSON.content,
                            parent: commentJSON.parent
                        },
                        success: function(comment) {
                            success(comment)
                        },
                        error: error
                    })
                },
                timeFormatter: function(time) {
                    let date = new Date(time)
                    return date.toLocaleDateString() + ' ' + ('0' + date.getHours()).slice(-2) + ':' + ('0' + date.getMinutes()).slice(-2)
                },
                defaultNavigationSortKey: 'newest',
                roundProfilePictures: false,
                textareaRows: 2,
                textareaRowsOnFocus: 2,
                textareaMaxRows: 5,
                maxRepliesVisible: 20,
                // getUsers: function(success, error) {
                //     setTimeout(function() {
                //         success(usersArray);
                //     }, 500);
                // },
                // uploadAttachments: function(dataArray, success, error) {
                //     setTimeout(function() {
                //         success(dataArray);
                //     }, 500);
                // },
            });
        })
    </script>
{% endblock %}
