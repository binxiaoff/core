{% extends 'lender_account/_layout_lender.html.twig' %}

{% set page = {
    id: 'user-preter-profile-documents',
    classNames: 'user-preter-profile'
} %}

{% block dashboardContent %}
    <div class="dashboard-tabs tabs">
        <div class="dashboard-tabs-content tab-content">
            <div id="profile-info" role="tabpanel" class="dashboard-tab-pane tab-pane active">
                <article id="lender-completeness" class="panel collapse in">
                    <header class="panel-header">
                        <h3>{% trans %} lender-profile_completeness-form-title {% endtrans %}</h3>
                    </header>

                    <section id="profile-lender-completeness-section">
                        <form id="form-lender-completeness" action="{{ path('lender_completeness_submit') }}" method="post" enctype="multipart/form-data" class="form-lender-completeness">
                            <div id="form-lender-completeness-content" aria-labelledby="lender-completeness lender-completeness-title" data-formvalidation data-formvalidation-notificationselem="#form-lender-completeness-notifications">
                                <fieldset class="panel">
                                    <div id="form-lender-completeness-notifications" class="ui-formvalidation-notifications"></div>

                                    <div class="row">
                                        <div class="form-field">
                                            {% if app.session.flashBag.has('completenessSuccess') %}
                                                <div id="form-lender-completeness-notifications">
                                                    <div class="message-success">
                                                        {% for message in app.session.flashBag.get('completenessSuccess') %}
                                                            <span>{{ message }}</span>
                                                        {% endfor %}
                                                    </div>
                                                </div>
                                            {% elseif app.session.flashBag.has('completenessError') %}
                                                <div id="form-lender-completeness-notifications">
                                                    <div class="message-error">
                                                        {% for message in app.session.flashBag.get('completenessError') %}
                                                            <span>{{ message }}</span>
                                                        {% endfor %}
                                                    </div>
                                                </div>
                                            {% else %}
                                                <div class="message-info">
                                                    <p>{% trans %} lender-profile_completeness-form-requested-documents {% endtrans %}</p>
                                                    {% if attachmentsList is defined %}
                                                        {{ attachmentsList|raw }}
                                                    {% endif %}
                                                </div><!-- /.message-info -->
                                            {% endif %}

                                            <div class="form-field">
                                                {# Template is defined here so you can better do the translation and select field stuff #}
                                                <div id="form-extrafiles-template" class="ui-template-definition" style="display: none" disabled="disabled" aria-hidden="true">
                                                    <div class="form-field file-upload-extra row row-multi-col-computer">
                                                        <div class="col-lg-6 col-md-6">
                                                            <select name="files[extra__NUM__]" class="input-field">
                                                                <option value="">{% trans %} lender-profile_completeness-form-select-label {% endtrans %}</option>
                                                                {% for attachmentType in attachmentTypes %}
                                                                    <option value="{{ attachmentType.id }}">{{ ('projet_document-type-' ~ attachmentType.id)|trans}}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                        <div class="col-lg-6 col-md-6">
                                                            <div class="custom-input-file" id="form-extrafile" data-fileattach data-fileattach-inputname="extra__NUM__" data-fileattach-maxfiles="1" data-fileattach-filetypes="pdf jpg jpeg png doc docx"></div><!-- /.ui-fileattach -->
                                                        </div>
                                                    </div><!-- /.file-upload-extra -->
                                                </div><!-- /.ui-template-definition -->

                                                {% if bankForm %}
                                                    <div class="row row-multi-col margin-20-b collapse" id="completeness-bank-account">
                                                        <div class="col-sm-4 col-md-6 col-lg-6">
                                                            <div class="form-field">
                                                                <input type="hidden" id="document-id-rib" value="{{ constant('\\Unilend\\Entity\\AttachmentType::RIB') }}">
                                                                <label for="iban" class="form-field-label">
                                                                    {% trans %} lender-profile_completeness-bank-info-section-iban {% endtrans %}
                                                                    <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span>
                                                                </label>
                                                                <div class="input-group">
                                                                    <div class="custom-input-iban">
                                                                        {{ form_widget(bankForm.bankAccount.iban, {
                                                                            'id' : 'form-profile-completeness-iban',
                                                                            'attr' : {
                                                                                'class' : 'iban-input input-field',
                                                                                'data-formvalidation-input data-formvalidation-required' : 'true',
                                                                                'data-formvalidation-type' : 'iban'
                                                                            }
                                                                        }) }}
                                                                        {{ form_errors(bankForm.bankAccount.iban) }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4 col-md-6 col-lg-6">
                                                            <div class="form-field">
                                                                <label for="bic" class="form-field-label">
                                                                    {% trans %} lender-profile_completeness-bank-info-section-bic {% endtrans %}
                                                                    <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span>
                                                                </label>
                                                                <div class="custom-input-bic">
                                                                    <div class="custom-input-bic">
                                                                        {{ form_widget(bankForm.bankAccount.bic, {
                                                                            'id' : 'form-profile-completeness-bic',
                                                                            'attr' :  {
                                                                                'class' : 'bic-input input-field',
                                                                                'data-formvalidation-input data-formvalidation-required' : 'true',
                                                                                'data-formvalidation-type' : 'bic'
                                                                            }
                                                                        }) }}
                                                                        {{ form_errors(bankForm.bankAccount.bic) }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if mainAddressForm %}
                                                    <div class="row row-multi-col margin-20-b collapse" id="completeness-main-address">
                                                        <div class="row">
                                                            <input type="hidden" id="document-id-housing-certificate" value="{{ constant('\\Unilend\\Entity\\AttachmentType::JUSTIFICATIF_DOMICILE') }}">
                                                            <div class="form-field {% if mainAddressForm.address.vars.errors|length > 0 %}ui-formvalidation-error{% endif %}">
                                                                <label for="form-completeness-address-street">{% trans %} lender-profile_completeness-fiscal-address-section-address-label {% endtrans %}
                                                                    <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span>
                                                                </label>
                                                                {{ form_widget(mainAddressForm.address, {
                                                                    'attr' : {
                                                                        'class' : 'input-field',
                                                                        'data-formvalidation-input' : true,
                                                                        'data-formvalidation-required' : true
                                                                    }})
                                                                }}
                                                                {{ form_errors(mainAddressForm.address) }}
                                                            </div><!-- /.form-field -->
                                                        </div>

                                                        <div class="row row-multi-col-computer">
                                                            <div class="form-field col-lg-6 col-md-6 {% if mainAddressForm.zip.vars.errors|length > 0 %}ui-formvalidation-error{% endif %}">
                                                                <label for="form-completeness-address-code">{% trans %} lender-profile_completeness-fiscal-address-section-zip-label {% endtrans %}
                                                                    <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span>
                                                                </label>
                                                                <div class="input-group set-right">
                                                                    {{ form_widget(mainAddressForm.zip, {
                                                                        'id' : 'form-completeness-address-code',
                                                                        'attr' : {
                                                                            'class' : 'input-field',
                                                                            'data-formvalidation-input data-formvalidation-required' : 'true',
                                                                            'data-autocomplete-address data-autocomplete-ajaxurl' : path('lender_profile_ajax_zip'),
                                                                            'data-autocomplete-address-countryelem' : '#form-completeness-address-pays',
                                                                            'data-autocomplete-address-cityelem' : '#form-completeness-address-ville',
                                                                            'data-autocomplete-address-zipelem' : '#form-completeness-address-code',
                                                                            'data-has-spinner' : '#spinner-completeness-address-code'
                                                                        }})
                                                                    }}
                                                                    {{ form_errors(mainAddressForm.zip) }}
                                                                    <div class="btn-group">
                                                                        <span id="spinner-completeness-address-code" class="ui-is-spinner"><span class="sr-only">{% trans %} common_loading {% endtrans %}</span></span>
                                                                    </div>
                                                                </div><!-- /.input-group -->
                                                            </div><!-- /.form-field -->
                                                            <div class="form-field col-lg-6 col-md-6 {% if mainAddressForm.city.vars.errors|length > 0 %}ui-formvalidation-error{% endif %}">
                                                                <label for="form-completeness-address-ville">{% trans %} lender-profile_completeness-fiscal-address-section-city-label {% endtrans %}
                                                                    <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span></label>
                                                                <div class="input-group set-right">
                                                                    {{ form_widget(mainAddressForm.city, {
                                                                        'id' : 'form-completeness-address-ville',
                                                                        'attr' : {
                                                                            'class' : 'input-field',
                                                                            'data-formvalidation-input data-formvalidation-required' : 'true',
                                                                            'data-autocomplete-address data-autocomplete-ajaxurl' : path('lender_profile_ajax_zip'),
                                                                            'data-autocomplete-address-countryelem' : '#form-completeness-address-pays',
                                                                            'data-autocomplete-address-cityelem' : '#form-completeness-address-ville',
                                                                            'data-autocomplete-address-zipelem' : '#form-completeness-address-code',
                                                                            'data-has-spinner' : '#spinner-completeness-address-city'
                                                                        }})
                                                                    }}
                                                                    {{ form_errors(mainAddressForm.city) }}
                                                                    <div class="btn-group">
                                                                        <span id="spinner-completeness-address-city" class="ui-is-spinner"><span class="sr-only">{% trans %} common_loading {% endtrans %}</span></span>
                                                                    </div>
                                                                </div><!-- /.input-group -->
                                                            </div><!-- /.form-field -->
                                                        </div>

                                                        <div class="row row-multi-col-computer">
                                                            <div class="form-field col-lg-6 col-md-6 {% if mainAddressForm.idCountry.vars.errors|length > 0 %}ui-formvalidation-error{% endif %}">
                                                                <label for="form-completeness-address-pays">{% trans %} lender-profile_completeness-fiscal-address-section-country-label {% endtrans %}
                                                                    <span class="field-required">*<span class="sr-only"> {% trans %} common_mandatory-field {% endtrans %}</span></span></label>
                                                                {{ form_widget(mainAddressForm.idCountry, {
                                                                    'id' : 'form-completeness-address-pays',
                                                                    'attr' : {
                                                                        'class' : 'input-field',
                                                                        'data-formvalidation-input' : true,
                                                                        'data-formvalidation-required' : true
                                                                    }})
                                                                }}
                                                                {{ form_errors(mainAddressForm.idCountry) }}
                                                            </div><!-- /.form-field -->
                                                        </div>
                                                    </div>
                                                {% endif %}

                                                <div class="form-extrafiles-list">
                                                    <div class="form-field row row-multi-col-computer" style="margin-bottom: 0">
                                                        <div class="col-lg-6 col-md-6" style="margin-bottom: 0">
                                                            <label class="field-label">{% trans %} lender-profile_completeness-form-document-type-column-title {% endtrans %}</label>
                                                        </div>
                                                        <div class="col-lg-6 col-md-6 hide-mobile" style="margin-bottom: 0">
                                                            <div class="field-label">{% trans %} lender-profile_completeness-form-column-title {% endtrans %}</div>
                                                        </div>
                                                    </div>

                                                    <div class="form-field file-upload-extra row row-multi-col-computer">
                                                        <div class="col-lg-6 col-md-6">
                                                            <select name="files[file]" class="input-field">
                                                                <option value="">{% trans %} lender-profile_completeness-form-select-label {% endtrans %}</option>
                                                                {% for attachmentType in attachmentTypes %}
                                                                    <option value="{{ attachmentType.id }}">{{ ('projet_document-type-' ~ attachmentType.id)|trans }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                        <div class="col-lg-6 col-md-6">
                                                            <div class="custom-input-file" id="form-file" data-fileattach data-fileattach-inputname="file" data-fileattach-maxfiles="1" data-fileattach-filetypes="pdf jpg jpeg png doc docx" data-formvalidation-input data-formvalidation-required='input[type="file"][name="file[0]"]'></div><!-- /.ui-fileattach -->
                                                        </div>
                                                    </div>

                                                    {# Other files will get added here #}
                                                </div><!-- /.form-extrafiles-list -->

                                                <a href="javascript:;" class="btn-default btn-shape-sq-md ui-form-extrafiles-add">
                                                    <span class="icon fa-plus-u16 c-t2"></span>
                                                    <span class="sr-only">{% trans %} lender-profile_completeness-form-add-file-label {% endtrans %}</span>
                                                </a>
                                            </div><!-- /.form-field -->
                                        </div><!-- /.form-field -->
                                    </div>
                                    <div class="row">
                                        <div class="row reverse btn-controls tab-footer">
                                            <div class="col-submit col-lg-7 col-md-7">
                                                <button type="submit" class="btn-primary" data-spinnerbutton>
                                                    <span class="icon fa-check-u16"></span>
                                                    {% trans %} lender-profile_completeness-form-submit-button {% endtrans %}
                                                </button>
                                            </div>
                                        </div><!-- /.btn-controls.tab-footer -->
                                    </div>
                                </fieldset>
                            </div>
                        </form>
                    </section><!-- /.ui-toggle-group -->
                </article><!-- /.panel -->
            </div>
        </div>
    </div>
{% endblock %}
