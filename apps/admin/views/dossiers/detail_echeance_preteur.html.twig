{% extends 'layout.html.twig' %}

{% block pluginsCSS %}
    <link rel="stylesheet" href="{{ app.adminUrl }}/oneui/js/plugins/datatables/jquery.dataTables.min.css">
{% endblock %}

{% block pluginsJS %}
    <script src="{{ app.adminUrl }}/oneui/js/plugins/datatables/jquery.dataTables.min.js"></script>
{% endblock %}

{% block pageScripts %}
    <script>
        $(function () {
            App.initHelper('datatables')
        })
    </script>
{% endblock %}

{% block pageHeader %}
    <div class="pull-right text-right">
        <div class="push-5"><a href="{{ app.adminUrl }}/dossiers/edit/{{ project.idProject }}">{{ project.title }}</a></div>
        <div class="label ui-project-status-{{ project.status }}-bg ui-company-status-{{ companyStatus.label }}-bg">
            {{ projectStatus.label }}
        </div>
    </div>
    <h1 class="page-heading push">
        Échéancier du prêteur
        <small>
            <a href="{{ app.adminUrl }}/preteurs/edit/{{ loan.idLender.idClient.idClient }}">
                {% if lenderCompanyName is not empty %}
                    {{ lenderCompanyName }} <span class="fa fa-suitcase"></span>
                {% else %}
                    {{ loan.idLender.idClient.prenom }} {{ loan.idLender.idClient.nom }} <span class="fa fa-user-o"></span>
                {% endif %}
            </a>
        </small>
    </h1>
{% endblock %}

{% block content %}
    <div class="content">
        <div class="row">
            <div class="col-xs-4 col-sm-2">
                <div class="block">
                    <div class="block-header">
                        <h3 class="block-title">Montant prêté</h3>
                    </div>
                    <div class="block-content text-center">
                        <p class="h3 text-primary pull-t">{{ (loan.amount / 100)|localizednumber }}&nbsp;€</p>
                    </div>
                </div>
            </div>
            <div class="col-xs-4 col-sm-2">
                <div class="block">
                    <div class="block-header">
                        <h3 class="block-title">Capital restant dû</h3>
                    </div>
                    <div class="block-content text-center">
                        <p class="h3 text-primary pull-t">{{ owedCapital|localizedcurrency('EUR') }}</p>
                    </div>
                </div>
            </div>
            <div class="col-xs-4 col-sm-2">
                <div class="block">
                    <div class="block-header">
                        <h3 class="block-title">Taux d'intérêt</h3>
                    </div>
                    <div class="block-content text-center">
                        <p class="h3 text-primary pull-t">{{ loan.rate|localizednumber }}&nbsp;%</p>
                    </div>
                </div>
            </div>
            <div class="col-xs-4 col-sm-2">
                <div class="block">
                    <div class="block-header">
                        <h3 class="block-title">Nombre d'échéances</h3>
                    </div>
                    <div class="block-content text-center">
                        <p class="h3 text-primary pull-t">{{ project.period|localizednumber }}</p>
                    </div>
                </div>
            </div>
            <div class="col-xs-4 col-sm-2">
                <div class="block">
                    <div class="block-header">
                        <h3 class="block-title">Échéances restantes</h3>
                    </div>
                    <div class="block-content text-center">
                        <p class="h3 text-primary pull-t">{{ leftRepayments|localizednumber }}</p>
                    </div>
                </div>
            </div>
            <div class="col-xs-4 col-sm-2">
                <div class="block">
                    <div class="block-header">
                        <h3 class="block-title">Sous-jacent</h3>
                    </div>
                    <div class="block-content text-center">
                        <p class="h3 text-primary pull-t">{{ ('contract-type-label_' ~ loan.idTypeContract.label)|trans }}</p>
                    </div>
                </div>
            </div>
        </div>
        {% if earlyRepayment is not empty %}
            <div class="row">
                <div class="col-xs-6 col-sm-6">
                    <div class="block">
                        <div class="block-header">
                            <h3 class="block-title">Capital remboursé par anticipation</h3>
                        </div>
                        <div class="block-content text-center">
                            <p class="h3 text-primary pull-t">{{ earlyRepayment.amount|localizedcurrency('EUR') }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-xs-6 col-sm-6">
                    <div class="block">
                        <div class="block-header">
                            <h3 class="block-title">Date remboursement anticipé</h3>
                        </div>
                        <div class="block-content text-center">
                            <p class="h3 text-primary pull-t">
                                {{ earlyRepayment.repaymentDate|localizeddate('short', 'none') }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        <div class="block">
            <div class="block-content block-content-full">
                <table class="table table-bordered table-striped table-header-bg" data-table data-paging="false" data-lengthchange="false" data-info="false">
                    <thead>
                    <tr>
                        <th style="width: 5%;">#</th>
                        <th style="width: 10%;">Capital</th>
                        <th style="width: 10%;">Capital remboursé</th>
                        <th style="width: 10%;">Intérêts</th>
                        <th style="width: 10%;">Intérêts remboursés</th>
                        <th style="width: 10%;">Taxes</th>
                        <th style="width: 15%;">Date théorique</th>
                        <th style="width: 15%;">Date réelle</th>
                        <th style="width: 15%;">Statut</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for repayment in repayments %}
                        <tr>
                            <td class="text-right">{{ repayment.sequence }}</td>
                            <td class="text-right" data-order="{{ repayment.capital }}">{{ repayment.capital|localizedcurrency('EUR') }}</td>
                            <td class="text-right" data-order="{{ repayment.repaidCapital }}">
                                {% if repayment.status != constant('Unilend\\Entity\\Echeanciers::STATUS_PENDING') %}
                                    {{ repayment.repaidCapital|localizedcurrency('EUR') }}
                                {% endif %}
                            </td>
                            <td class="text-right" data-order="{{ repayment.interests }}">{{ repayment.interests|localizedcurrency('EUR') }}</td>
                            <td class="text-right" data-order="{{ repayment.repaidInterests }}">
                                {% if repayment.status != constant('Unilend\\Entity\\Echeanciers::STATUS_PENDING') %}
                                    {{ repayment.repaidInterests|localizedcurrency('EUR') }}
                                {% endif %}
                            </td>
                            <td class="text-right" data-order="{{ repayment.taxes }}">
                                {% if repayment.status != constant('Unilend\\Entity\\Echeanciers::STATUS_PENDING') %}
                                    {{ repayment.taxes|localizedcurrency('EUR') }}
                                {% endif %}
                            </td>
                            <td>{{ repayment.theoreticalRepaymentDate|localizeddate('short', 'none') }}</td>
                            <td>{% if repayment.actualRepaymentDate is not empty %}{{ repayment.actualRepaymentDate|localizeddate('short', 'none') }}{% endif %}</td>
                            <td>
                                {% if repayment.status == constant('Unilend\\Entity\\Echeanciers::STATUS_PENDING') %}
                                    À venir
                                {% elseif repayment.status == constant('Unilend\\Entity\\Echeanciers::STATUS_PARTIALLY_REPAID') %}
                                    Partiellement remboursé
                                {% elseif repayment.status == constant('Unilend\\Entity\\Echeanciers::STATUS_REPAID') %}
                                    Remboursé
                                {% else %}
                                    Inconnu
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}
