{% extends 'layout.html.twig' %}

{% block pluginsCSS %}
    <link rel="stylesheet" href="{{ adminUrl }}/oneui/css/pages/tool-scores-project-status.css">
{% endblock %}

{% block pluginsJS %}
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/xrange.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
{% endblock %}

{% block pageScripts %}
    <script>
        $(function(){
            App.initHelpers();

            // Scores table
            var $scoresTable = $('.scores-table')
            var columnWidth = 200
            var columns = $scoresTable.find('tr:eq(0) td').length
            var tableWidth = columns * columnWidth
            var blockWidth = $scoresTable.parent().width()
            var bordersWidth = columns * 2

            if (tableWidth > blockWidth) {
                $scoresTable.width(columns * columnWidth + bordersWidth)
            } else {
                var emptyWidth = blockWidth - tableWidth
                console.log(blockWidth)
                var $bgColumn = '<td style="width: ' + emptyWidth + 'px"></td>'
                $scoresTable.find('tr').append($bgColumn)
                $scoresTable.unwrap()
            }

            // Chart
            Highcharts.chart('highcharts-chart', {
                chart: {
                    type: 'xrange'
                },
                title: {
                    text: ''
                },
                credits: {
                    enabled: false
                },
                xAxis: {
                    type: 'datetime'
                },
                yAxis: {
                    title: '',
                    categories: ['Projet #586753', 'Projet #32323', 'Projet #18327']
                },
                legend: {
                    layout: 'horizontal',
                    verticalAlign: 'top',
                    backgroundColor: '#FFFFFF',
                    align: 'left',
                    x: 40,
                },
                exporting: { enabled: false },
                tooltip: {
                    formatter: function () {
                        var start = Highcharts.dateFormat('%e. %b', this.x, true),
                                end = Highcharts.dateFormat('%e. %b', this.x2, true),
                                status = this.point.status,
                                type = this.point.type,
                                amount = this.point.amount

                        var html = '<b>' + status + ' : ' + start + ' - ' + end + '</b><br>' +
                                amount + ' | ' + type
                        return html
                    }
                },
                series: [
                    {
                        name: 'Projet #586753',
                        dataLabels: {
                            enabled: true,
                            align: 'left',
                            verticalAlign: 'middle',
                            style: {
                                fontSize: 12
                            },
                            formatter: function () {
                                return this.point.status
                            }
                        },
                        data: [
                            {
                                x: Date.UTC(2015, 01, 12),
                                x2: Date.UTC(2015, 01, 20),
                                y: 0,
                                color: "#d0f5d0",
                                status: 'Demande en cours',
                                type: 'Recrutement',
                                amount: '10, 000 €'
                            },
                            {
                                x: Date.UTC(2015, 01, 20),
                                x2: Date.UTC(2015, 01, 25),
                                y: 0,
                                color: "#aae3c9",
                                status: 'Demande Complète',
                                type: 'Recrutement',
                                amount: '10, 000 €'
                            },
                            {
                                x: Date.UTC(2015, 01, 25),
                                x2: Date.UTC(2015, 02, 1),
                                y: 0,
                                color: "#98d9d4",
                                status: 'Commercial',
                                type: 'Recrutement',
                                amount: '10, 000 €'
                            },
                            {
                                x: Date.UTC(2015, 02, 1),
                                x2: Date.UTC(2015, 02, 12),
                                y: 0,
                                color: "#91c8d9",
                                status: 'Analyste',
                                type: 'Recrutement',
                                amount: '10, 000 €'
                            },
                        ]
                    },
                    {
                        name: 'Projet #32323',
                        dataLabels: {
                            enabled: true,
                            align: 'left',
                            verticalAlign: 'middle',
                            style: {
                                fontSize: 12
                            },
                            formatter: function () {
                                return this.point.status
                            }
                        },
                        data: [
                            {
                                x: Date.UTC(2015, 01, 10),
                                x2: Date.UTC(2015, 01, 20),
                                y: 1,
                                id: 32323,
                                color: "#d0f5d0",
                                status: 'Demande en cours',
                                type: 'IT',
                                amount: '20, 000 €'
                            },
                            {
                                x: Date.UTC(2015, 01, 20),
                                x2: Date.UTC(2015, 01, 25),
                                y: 1,
                                id: 32323,
                                color: "#aae3c9",
                                status: 'Demande Complète',
                                type: 'IT',
                                amount: '20, 000 €'
                            },
                            {
                                x: Date.UTC(2015, 01, 25),
                                x2: Date.UTC(2015, 01, 30),
                                y: 1,
                                id: 32323,
                                color: "#98d9d4",
                                status: 'Commercial',
                                type: 'IT',
                                amount: '20, 000 €'
                            },
                            {
                                x: Date.UTC(2015, 01, 30),
                                x2: Date.UTC(2015, 02, 05),
                                y: 1,
                                id: 32323,
                                color: "#91c8d9",
                                status: 'Analyste',
                                type: 'IT',
                                amount: '20, 000 €'
                            },
                            {
                                x: Date.UTC(2015, 02, 05),
                                x2: Date.UTC(2015, 02, 07),
                                y: 1,
                                id: 32323,
                                color: "#80b5d9",
                                status: 'Comité',
                                type: 'IT',
                                amount: '20, 000 €'
                            },
                            {
                                x: Date.UTC(2015, 02, 07),
                                x2: Date.UTC(2015, 02, 08),
                                y: 1,
                                id: 32323,
                                color: "#b6babe",
                                status: 'Rejet Comité',
                                type: 'IT',
                                amount: '20, 000 €'
                            },
                        ]
                    },
                    {
                        name: 'Projet #18327',
                        dataLabels: {
                            enabled: true,
                            align: 'left',
                            verticalAlign: 'middle',
                            style: {
                                fontSize: 12
                            },
                            formatter: function () {
                                return this.point.status
                            }
                        },
                        data: [
                            {
                                x: Date.UTC(2015, 01, 10),
                                x2: Date.UTC(2015, 01, 20),
                                y: 2,
                                id: 32323,
                                color: "#d0f5d0",
                                status: 'Demande en cours',
                                type: 'IT',
                                amount: '20, 000 €'
                            },
                            {
                                x: Date.UTC(2015, 01, 20),
                                x2: Date.UTC(2015, 01, 25),
                                y: 2,
                                id: 32323,
                                color: "#aae3c9",
                                status: 'Demande Complète',
                                type: 'IT',
                                amount: '20, 000 €'
                            },
                            {
                                x: Date.UTC(2015, 01, 25),
                                x2: Date.UTC(2015, 01, 26),
                                y: 2,
                                id: 32323,
                                color: "#eccd81",
                                status: 'Abandon',
                                type: 'IT',
                                amount: '20, 000 €'
                            }
                        ]
                    }
                ]
            });
            Highcharts.chart('highcharts-chart-2', {
                chart: {
                    type: 'xrange'
                },
                title: {
                    text: ''
                },
                credits: {
                    enabled: false
                },
                xAxis: {
                    type: 'datetime'
                },
                yAxis: {
                    title: '',
                    categories: ['Projet #92753', 'Projet #87988']
                },
                legend: {
                    layout: 'horizontal',
                    verticalAlign: 'top',
                    backgroundColor: '#FFFFFF',
                    align: 'left',
                    x: 40,
                },
                exporting: { enabled: false },
                tooltip: {
                    formatter: function () {
                        var start = Highcharts.dateFormat('%e. %b', this.x, true),
                                end = Highcharts.dateFormat('%e. %b', this.x2, true),
                                status = this.point.status,
                                type = this.point.type,
                                amount = this.point.amount

                        var html = '<b>' + status + ' : ' + start + ' - ' + end + '</b><br>' +
                                amount + ' | ' + type
                        return html
                    }
                },
                series: [
                    {
                        name: 'Projet #92753',
                        dataLabels: {
                            enabled: true,
                            align: 'left',
                            verticalAlign: 'middle',
                            style: {
                                fontSize: 12
                            },
                            formatter: function () {
                                return this.point.status
                            }
                        },
                        data: [
                            {
                                x: Date.UTC(2016, 05, 12),
                                x2: Date.UTC(2017, 01, 20),
                                y: 0,
                                color: "#1b88db",
                                status: 'Remboursement',
                                type: 'Recrutement',
                                amount: '10, 000 €'
                            },
                            {
                                x: Date.UTC(2017, 01, 20),
                                x2: Date.UTC(2017, 01, 25),
                                y: 0,
                                color: "#4fa8b0",
                                status: 'Remboursé',
                                type: 'Recrutement',
                                amount: '10, 000 €'
                            }
                        ]
                    },
                    {
                        name: 'Projet #87988',
                        dataLabels: {
                            enabled: true,
                            align: 'left',
                            verticalAlign: 'middle',
                            style: {
                                fontSize: 12
                            },
                            formatter: function () {
                                var status = this.point.status.split(' ')
                                var abbr = ''
                                for (var word in status) {
                                    abbr += status[word].charAt(0)
                                }
                                return this.point.status
                            }
                        },
                        data: [
                            {
                                x: Date.UTC(2016, 12, 12),
                                x2: Date.UTC(2017, 03, 20),
                                y: 1,
                                color: "#1b88db",
                                status: 'Remboursement',
                                type: 'Recrutement',
                                amount: '20, 000 €'
                            },
                            {
                                x: Date.UTC(2017, 03, 20),
                                x2: Date.UTC(2017, 04, 27),
                                y: 1,
                                color: "#ffca2c",
                                status: 'Problème',
                                type: 'Recrutement',
                                amount: '20, 000 €'
                            },
                            {
                                x: Date.UTC(2017, 04, 27),
                                x2: Date.UTC(2017, 06, 15),
                                y: 1,
                                color: "#f2980c",
                                status: 'Recouvrement',
                                type: 'Recrutement',
                                amount: '20, 000 €'
                            }
                        ]
                    }
                ]
            });
        })
    </script>
{% endblock %}

 {% block modals %}
 {% endblock %}

{% block pageHeader %}
    <h1 class="page-heading push">
        Pascal et Beatrix
    </h1>
{% endblock %}

{% block content %}
    <div class="content">
        <div class="block">
            <div id="block-kpi" class="block-content">
                <div class="row">
                    <div class="col-md-2">
                        <div class="content-mini content-mini-full push" style="background: #f5f5f5;">
                            <div class="font-s12 font-w600 text-uppercase">Projets</div>
                            <a class="h2 font-w300 text-primary">4</a>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="content-mini content-mini-full push" style="background: #f5f5f5;">
                            <div class="font-s12 font-w600 text-uppercase">Abandons</div>
                            <a class="h2 font-w300 text-primary">1</a>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="content-mini content-mini-full push" style="background: #f5f5f5;">
                            <div class="font-s12 font-w600 text-uppercase">Rejets</div>
                            <a class="h2 font-w300 text-primary">0</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="block-scores" class="block block-bordered">
            <div class="block-header">
                <h3 class="block-title">Scoring de la société</h3>
            </div>
            <div class="block-content block-content-full">
                <div class="scores-container">
                    <table class="table table-bordered scores-fixed-column">
                        <tbody>
                            <tr>
                                <td>&nbsp;</td>
                            </tr>
                            <tr>
                                <th>Euler Hermes</th>
                            </tr>
                            <tr>
                                <th>Euler Hermes (Traffic Light)</th>
                            </tr>
                            <tr>
                                <th>Altares</th>
                            </tr>
                            <tr>
                                <th>Altares (Sectoriel)</th>
                            </tr>
                            <tr>
                                <th>Infolegale</th>
                            </tr>
                            <tr>
                                <th>Xerfi</th>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="scores-table-overscroll">
                        <table class="table table-bordered scores-table">
                            <tbody>
                            <tr>
                                <td class="score-item-header score-item-application">24/02/2016</td>
                                <td class="score-item-header score-item-monitoring">02/03/2016</td>
                                <td class="score-item-header score-item-application">24/02/2016</td>
                                <td class="score-item-header score-item-monitoring">02/03/2016</td>
                                <td class="score-item-header score-item-application">24/02/2016</td>
                                <td class="score-item-header score-item-monitoring">02/03/2016</td>
                                <td class="score-item-header score-item-application">24/02/2016</td>
                                <td class="score-item-header score-item-monitoring">02/03/2016</td>
                            </tr>
                            <tr>
                                <td>Green</td>
                                <td>Green</td>
                                <td>Green</td>
                                <td>Green</td>
                                <td>Green</td>
                                <td>Green</td>
                                <td>Green</td>
                                <td>Green</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td class="score-change"><span class="fa fa-arrow-up text-error"></span> 8</td>
                                <td class="score-change"><span class="fa fa-arrow-down text-success"></span> 7</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>6</td>
                                <td>6</td>
                                <td>6</td>
                                <td>6</td>
                                <td>6</td>
                                <td>6</td>
                                <td>6</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>5</td>
                                <td class="score-change"><span class="fa fa-arrow-up text-warning"></span> 6</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>5</td>
                                <td>Risk Fort</td>
                                <td>Risk Faible</td>
                            </tr>
                            <tr>
                                <td class="score-item-footer"><span>5 jours</span></td>
                                <td class="score-item-footer"><span>5 jours</span></td>
                                <td class="score-item-footer"><span>5 jours</span></td>
                                <td class="score-item-footer"><span>5 jours</span></td>
                                <td class="score-item-footer"><span>5 jours</span></td>
                                <td class="score-item-footer"><span>5 jours</span></td>
                                <td class="score-item-footer"><span>5 jours</span></td>
                                <td class="score-item-footer"><span>5 jours</span></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div id="block-projects-offline" class="block block-bordered">
            <div class="block-header">
                <h3 class="block-title">Projets en traitement</h3>
            </div>
            <div class="block-content block-content-full">
                <div class="highcharts-container">
                    <div class="row">
                        <div class="col-left">
                            <div id="highcharts-chart"></div>
                        </div>
                        <div class="col-right">
                            <div class="highcharts-legend">
                                <h5 class="push-10 font-w400">Legende des statuts</h5>
                                <ul>
                                    <li><span class="ui-application-bg"></span> Demande en cours</li>
                                    <li><span class="ui-application-complete-bg"></span> Demande complète</li>
                                    <li><span class="ui-commercial-bg"></span> Commercial</li>
                                    <li><span class="ui-analyst-bg"></span> Analyste</li>
                                    <li><span class="ui-comity-bg"></span> Comité</li>
                                    <li><span class="ui-prep-funding-bg"></span> Prep funding</li>
                                    <li>&nbsp;</li>
                                    <li><span class="ui-status-ko-bg"></span> Rejet</li>
                                    <li><span class="ui-conditions-bg"></span> Conditions</li>
                                    <li><span class="ui-abandon-bg"></span> Abandon</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="block-projects-online" class="block block-bordered">
            <div class="block-header">
                <h3 class="block-title">Projets en ligne</h3>
            </div>
            <div class="block-content block-content-full">
                <div class="highcharts-container">
                    <div class="row">
                        <div class="col-left">
                            <div id="highcharts-chart-2"></div>
                        </div>
                        <div class="col-right">
                            <div class="highcharts-legend">
                                <h5 class="push-10 font-w400">Legende des statuts</h5>
                                <ul>
                                    {# Don't show Funding status ?
                                    I am not sure whether it is really useful to display the Funding status #}
                                    {#On the highchart, as the Funding label overflows its bar (usually only 2 days long), #}
                                    {#the next status label (Remboursement) is automatically hidden / left out. #}
                                    {#That's why it is easier to simply omit the funding status.#}

                                    {#
                                    <li><span class="ui-funding-bg"></span> Funding / Fundé</li>
                                    #}

                                    <li><span class="ui-inprogress-bg"></span> Remboursement</li>
                                    <li><span class="ui-completed-bg"></span> Remboursé</li>
                                    <li><span class="ui-problem-bg"></span> Problème</li>
                                    <li><span class="ui-debt-collection-bg"></span> Recouvrement</li>
                                    <li><span class="ui-procedure-bg"></span> Procédure</li>
                                    <li><span class="ui-loss-bg"></span> Défaut</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
