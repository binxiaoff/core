services:
    unilend_monolog_support_formatter:
        class: Monolog\Formatter\LineFormatter
        autowire: true
        autoconfigure: true
        arguments:
            $format: "%%message%%"
            $ignoreEmptyContextAndExtra: true

monolog:
    channels: [console, support]
    handlers:
        error:
            type: fingers_crossed
            action_level: error
            handler: error_handler
            channels: ['!translation']
        error_handler:
            type: group
            members: [error_file]
        error_file:
            type: stream
            level: info
            path: "%kernel.logs_dir%/error.%kernel.environment%.log"
            channels: ['!support']
        console_filter:
            type: filter
            handler: console_handler
            max_level: warning
            channels: console
        console_handler:
            type: group
            members: [console_file, console_console]
        console_file:
            type: stream
            path: "%kernel.logs_dir%/console.%kernel.environment%.log"
            level: info
        console_console:
            type: console
        site_filter:
            type: filter
            handler: site_handler
            max_level: warning
            channels: ['!console', '!translation', '!support']
        site_handler:
            type: stream
            level: warning
            path: "%kernel.logs_dir%/site.%kernel.environment%.log"
        slack_support:
            type: slackwebhook
            webhook_url: "%env(string:SLACK_WEBHOOK_URL)%"
            level: info
            channels: ['support']
            channel: '#%env(string:SLACK_CHANNEL_SUPPORT)%'
            bot_name: 'API'
            use_short_attachment: false
            include_extra: true
            formatter: 'unilend_monolog_support_formatter'
